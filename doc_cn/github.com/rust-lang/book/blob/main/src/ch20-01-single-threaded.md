{"payload":{"allShortcutsEnabled":false,"fileTree":{"src":{"items":[{"name":"img","path":"src/img","contentType":"directory"},{"name":"SUMMARY.md","path":"src/SUMMARY.md","contentType":"file"},{"name":"appendix-00.md","path":"src/appendix-00.md","contentType":"file"},{"name":"appendix-01-keywords.md","path":"src/appendix-01-keywords.md","contentType":"file"},{"name":"appendix-02-operators.md","path":"src/appendix-02-operators.md","contentType":"file"},{"name":"appendix-03-derivable-traits.md","path":"src/appendix-03-derivable-traits.md","contentType":"file"},{"name":"appendix-04-useful-development-tools.md","path":"src/appendix-04-useful-development-tools.md","contentType":"file"},{"name":"appendix-05-editions.md","path":"src/appendix-05-editions.md","contentType":"file"},{"name":"appendix-06-translation.md","path":"src/appendix-06-translation.md","contentType":"file"},{"name":"appendix-07-nightly-rust.md","path":"src/appendix-07-nightly-rust.md","contentType":"file"},{"name":"ch00-00-introduction.md","path":"src/ch00-00-introduction.md","contentType":"file"},{"name":"ch01-00-getting-started.md","path":"src/ch01-00-getting-started.md","contentType":"file"},{"name":"ch01-01-installation.md","path":"src/ch01-01-installation.md","contentType":"file"},{"name":"ch01-02-hello-world.md","path":"src/ch01-02-hello-world.md","contentType":"file"},{"name":"ch01-03-hello-cargo.md","path":"src/ch01-03-hello-cargo.md","contentType":"file"},{"name":"ch02-00-guessing-game-tutorial.md","path":"src/ch02-00-guessing-game-tutorial.md","contentType":"file"},{"name":"ch03-00-common-programming-concepts.md","path":"src/ch03-00-common-programming-concepts.md","contentType":"file"},{"name":"ch03-01-variables-and-mutability.md","path":"src/ch03-01-variables-and-mutability.md","contentType":"file"},{"name":"ch03-02-data-types.md","path":"src/ch03-02-data-types.md","contentType":"file"},{"name":"ch03-03-how-functions-work.md","path":"src/ch03-03-how-functions-work.md","contentType":"file"},{"name":"ch03-04-comments.md","path":"src/ch03-04-comments.md","contentType":"file"},{"name":"ch03-05-control-flow.md","path":"src/ch03-05-control-flow.md","contentType":"file"},{"name":"ch04-00-understanding-ownership.md","path":"src/ch04-00-understanding-ownership.md","contentType":"file"},{"name":"ch04-01-what-is-ownership.md","path":"src/ch04-01-what-is-ownership.md","contentType":"file"},{"name":"ch04-02-references-and-borrowing.md","path":"src/ch04-02-references-and-borrowing.md","contentType":"file"},{"name":"ch04-03-slices.md","path":"src/ch04-03-slices.md","contentType":"file"},{"name":"ch05-00-structs.md","path":"src/ch05-00-structs.md","contentType":"file"},{"name":"ch05-01-defining-structs.md","path":"src/ch05-01-defining-structs.md","contentType":"file"},{"name":"ch05-02-example-structs.md","path":"src/ch05-02-example-structs.md","contentType":"file"},{"name":"ch05-03-method-syntax.md","path":"src/ch05-03-method-syntax.md","contentType":"file"},{"name":"ch06-00-enums.md","path":"src/ch06-00-enums.md","contentType":"file"},{"name":"ch06-01-defining-an-enum.md","path":"src/ch06-01-defining-an-enum.md","contentType":"file"},{"name":"ch06-02-match.md","path":"src/ch06-02-match.md","contentType":"file"},{"name":"ch06-03-if-let.md","path":"src/ch06-03-if-let.md","contentType":"file"},{"name":"ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","path":"src/ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","contentType":"file"},{"name":"ch07-01-packages-and-crates.md","path":"src/ch07-01-packages-and-crates.md","contentType":"file"},{"name":"ch07-02-defining-modules-to-control-scope-and-privacy.md","path":"src/ch07-02-defining-modules-to-control-scope-and-privacy.md","contentType":"file"},{"name":"ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","path":"src/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","contentType":"file"},{"name":"ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","path":"src/ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","contentType":"file"},{"name":"ch07-05-separating-modules-into-different-files.md","path":"src/ch07-05-separating-modules-into-different-files.md","contentType":"file"},{"name":"ch08-00-common-collections.md","path":"src/ch08-00-common-collections.md","contentType":"file"},{"name":"ch08-01-vectors.md","path":"src/ch08-01-vectors.md","contentType":"file"},{"name":"ch08-02-strings.md","path":"src/ch08-02-strings.md","contentType":"file"},{"name":"ch08-03-hash-maps.md","path":"src/ch08-03-hash-maps.md","contentType":"file"},{"name":"ch09-00-error-handling.md","path":"src/ch09-00-error-handling.md","contentType":"file"},{"name":"ch09-01-unrecoverable-errors-with-panic.md","path":"src/ch09-01-unrecoverable-errors-with-panic.md","contentType":"file"},{"name":"ch09-02-recoverable-errors-with-result.md","path":"src/ch09-02-recoverable-errors-with-result.md","contentType":"file"},{"name":"ch09-03-to-panic-or-not-to-panic.md","path":"src/ch09-03-to-panic-or-not-to-panic.md","contentType":"file"},{"name":"ch10-00-generics.md","path":"src/ch10-00-generics.md","contentType":"file"},{"name":"ch10-01-syntax.md","path":"src/ch10-01-syntax.md","contentType":"file"},{"name":"ch10-02-traits.md","path":"src/ch10-02-traits.md","contentType":"file"},{"name":"ch10-03-lifetime-syntax.md","path":"src/ch10-03-lifetime-syntax.md","contentType":"file"},{"name":"ch11-00-testing.md","path":"src/ch11-00-testing.md","contentType":"file"},{"name":"ch11-01-writing-tests.md","path":"src/ch11-01-writing-tests.md","contentType":"file"},{"name":"ch11-02-running-tests.md","path":"src/ch11-02-running-tests.md","contentType":"file"},{"name":"ch11-03-test-organization.md","path":"src/ch11-03-test-organization.md","contentType":"file"},{"name":"ch12-00-an-io-project.md","path":"src/ch12-00-an-io-project.md","contentType":"file"},{"name":"ch12-01-accepting-command-line-arguments.md","path":"src/ch12-01-accepting-command-line-arguments.md","contentType":"file"},{"name":"ch12-02-reading-a-file.md","path":"src/ch12-02-reading-a-file.md","contentType":"file"},{"name":"ch12-03-improving-error-handling-and-modularity.md","path":"src/ch12-03-improving-error-handling-and-modularity.md","contentType":"file"},{"name":"ch12-04-testing-the-librarys-functionality.md","path":"src/ch12-04-testing-the-librarys-functionality.md","contentType":"file"},{"name":"ch12-05-working-with-environment-variables.md","path":"src/ch12-05-working-with-environment-variables.md","contentType":"file"},{"name":"ch12-06-writing-to-stderr-instead-of-stdout.md","path":"src/ch12-06-writing-to-stderr-instead-of-stdout.md","contentType":"file"},{"name":"ch13-00-functional-features.md","path":"src/ch13-00-functional-features.md","contentType":"file"},{"name":"ch13-01-closures.md","path":"src/ch13-01-closures.md","contentType":"file"},{"name":"ch13-02-iterators.md","path":"src/ch13-02-iterators.md","contentType":"file"},{"name":"ch13-03-improving-our-io-project.md","path":"src/ch13-03-improving-our-io-project.md","contentType":"file"},{"name":"ch13-04-performance.md","path":"src/ch13-04-performance.md","contentType":"file"},{"name":"ch14-00-more-about-cargo.md","path":"src/ch14-00-more-about-cargo.md","contentType":"file"},{"name":"ch14-01-release-profiles.md","path":"src/ch14-01-release-profiles.md","contentType":"file"},{"name":"ch14-02-publishing-to-crates-io.md","path":"src/ch14-02-publishing-to-crates-io.md","contentType":"file"},{"name":"ch14-03-cargo-workspaces.md","path":"src/ch14-03-cargo-workspaces.md","contentType":"file"},{"name":"ch14-04-installing-binaries.md","path":"src/ch14-04-installing-binaries.md","contentType":"file"},{"name":"ch14-05-extending-cargo.md","path":"src/ch14-05-extending-cargo.md","contentType":"file"},{"name":"ch15-00-smart-pointers.md","path":"src/ch15-00-smart-pointers.md","contentType":"file"},{"name":"ch15-01-box.md","path":"src/ch15-01-box.md","contentType":"file"},{"name":"ch15-02-deref.md","path":"src/ch15-02-deref.md","contentType":"file"},{"name":"ch15-03-drop.md","path":"src/ch15-03-drop.md","contentType":"file"},{"name":"ch15-04-rc.md","path":"src/ch15-04-rc.md","contentType":"file"},{"name":"ch15-05-interior-mutability.md","path":"src/ch15-05-interior-mutability.md","contentType":"file"},{"name":"ch15-06-reference-cycles.md","path":"src/ch15-06-reference-cycles.md","contentType":"file"},{"name":"ch16-00-concurrency.md","path":"src/ch16-00-concurrency.md","contentType":"file"},{"name":"ch16-01-threads.md","path":"src/ch16-01-threads.md","contentType":"file"},{"name":"ch16-02-message-passing.md","path":"src/ch16-02-message-passing.md","contentType":"file"},{"name":"ch16-03-shared-state.md","path":"src/ch16-03-shared-state.md","contentType":"file"},{"name":"ch16-04-extensible-concurrency-sync-and-send.md","path":"src/ch16-04-extensible-concurrency-sync-and-send.md","contentType":"file"},{"name":"ch17-00-oop.md","path":"src/ch17-00-oop.md","contentType":"file"},{"name":"ch17-01-what-is-oo.md","path":"src/ch17-01-what-is-oo.md","contentType":"file"},{"name":"ch17-02-trait-objects.md","path":"src/ch17-02-trait-objects.md","contentType":"file"},{"name":"ch17-03-oo-design-patterns.md","path":"src/ch17-03-oo-design-patterns.md","contentType":"file"},{"name":"ch18-00-patterns.md","path":"src/ch18-00-patterns.md","contentType":"file"},{"name":"ch18-01-all-the-places-for-patterns.md","path":"src/ch18-01-all-the-places-for-patterns.md","contentType":"file"},{"name":"ch18-02-refutability.md","path":"src/ch18-02-refutability.md","contentType":"file"},{"name":"ch18-03-pattern-syntax.md","path":"src/ch18-03-pattern-syntax.md","contentType":"file"},{"name":"ch19-00-advanced-features.md","path":"src/ch19-00-advanced-features.md","contentType":"file"},{"name":"ch19-01-unsafe-rust.md","path":"src/ch19-01-unsafe-rust.md","contentType":"file"},{"name":"ch19-03-advanced-traits.md","path":"src/ch19-03-advanced-traits.md","contentType":"file"},{"name":"ch19-04-advanced-types.md","path":"src/ch19-04-advanced-types.md","contentType":"file"},{"name":"ch19-05-advanced-functions-and-closures.md","path":"src/ch19-05-advanced-functions-and-closures.md","contentType":"file"},{"name":"ch19-06-macros.md","path":"src/ch19-06-macros.md","contentType":"file"},{"name":"ch20-00-final-project-a-web-server.md","path":"src/ch20-00-final-project-a-web-server.md","contentType":"file"},{"name":"ch20-01-single-threaded.md","path":"src/ch20-01-single-threaded.md","contentType":"file"},{"name":"ch20-02-multithreaded.md","path":"src/ch20-02-multithreaded.md","contentType":"file"},{"name":"ch20-03-graceful-shutdown-and-cleanup.md","path":"src/ch20-03-graceful-shutdown-and-cleanup.md","contentType":"file"},{"name":"foreword.md","path":"src/foreword.md","contentType":"file"},{"name":"title-page.md","path":"src/title-page.md","contentType":"file"}],"totalCount":106},"":{"items":[{"name":".cargo","path":".cargo","contentType":"directory"},{"name":".github","path":".github","contentType":"directory"},{"name":"2018-edition","path":"2018-edition","contentType":"directory"},{"name":"ci","path":"ci","contentType":"directory"},{"name":"dot","path":"dot","contentType":"directory"},{"name":"first-edition","path":"first-edition","contentType":"directory"},{"name":"listings","path":"listings","contentType":"directory"},{"name":"nostarch","path":"nostarch","contentType":"directory"},{"name":"redirects","path":"redirects","contentType":"directory"},{"name":"second-edition","path":"second-edition","contentType":"directory"},{"name":"src","path":"src","contentType":"directory"},{"name":"theme","path":"theme","contentType":"directory"},{"name":"tools","path":"tools","contentType":"directory"},{"name":".gitattributes","path":".gitattributes","contentType":"file"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":"ADMIN_TASKS.md","path":"ADMIN_TASKS.md","contentType":"file"},{"name":"CONTRIBUTING.md","path":"CONTRIBUTING.md","contentType":"file"},{"name":"COPYRIGHT","path":"COPYRIGHT","contentType":"file"},{"name":"Cargo.lock","path":"Cargo.lock","contentType":"file"},{"name":"Cargo.toml","path":"Cargo.toml","contentType":"file"},{"name":"LICENSE-APACHE","path":"LICENSE-APACHE","contentType":"file"},{"name":"LICENSE-MIT","path":"LICENSE-MIT","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"TODO.md","path":"TODO.md","contentType":"file"},{"name":"book.toml","path":"book.toml","contentType":"file"},{"name":"ferris.css","path":"ferris.css","contentType":"file"},{"name":"ferris.js","path":"ferris.js","contentType":"file"},{"name":"rust-toolchain","path":"rust-toolchain","contentType":"file"},{"name":"rustfmt.toml","path":"rustfmt.toml","contentType":"file"},{"name":"style-guide.md","path":"style-guide.md","contentType":"file"}],"totalCount":30}},"fileTreeProcessingTime":19.486185,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":47854924,"defaultBranch":"main","name":"book","ownerLogin":"rust-lang","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2015-12-11T22:49:49.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/5430905?v=4","public":true,"private":false,"isOrgOwned":true},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1688046669.0","canEdit":false,"refType":"branch","currentOid":"72187f5cd0beaaa9c6f584156bcd88f921871e83"},"path":"src/ch20-01-single-threaded.md","currentUser":null,"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/rust-lang/book/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/rust-lang/book/security/dependabot","repoSecurityAndAnalysisPath":"/rust-lang/book/settings/security_analysis","repoOwnerIsOrg":true,"currentUserCanAdminRepo":false},"displayName":"ch20-01-single-threaded.md","displayUrl":"https://github.com/rust-lang/book/blob/main/src/ch20-01-single-threaded.md?raw=true","headerInfo":{"blobSize":"21 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"993239a","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Fbook%2Fblob%2Fmain%2Fsrc%2Fch20-01-single-threaded.md","isCSV":false,"isRichtext":true,"toc":[{"level":2,"text":"Building a Single-Threaded Web Server","anchor":"building-a-single-threaded-web-server","htmlText":"Building a Single-Threaded Web Server"},{"level":3,"text":"Listening to the TCP Connection","anchor":"listening-to-the-tcp-connection","htmlText":"Listening to the TCP Connection"},{"level":3,"text":"Reading the Request","anchor":"reading-the-request","htmlText":"Reading the Request"},{"level":3,"text":"A Closer Look at an HTTP Request","anchor":"a-closer-look-at-an-http-request","htmlText":"A Closer Look at an HTTP Request"},{"level":3,"text":"Writing a Response","anchor":"writing-a-response","htmlText":"Writing a Response"},{"level":3,"text":"Returning Real HTML","anchor":"returning-real-html","htmlText":"Returning Real HTML"},{"level":3,"text":"Validating the Request and Selectively Responding","anchor":"validating-the-request-and-selectively-responding","htmlText":"Validating the Request and Selectively Responding"},{"level":3,"text":"A Touch of Refactoring","anchor":"a-touch-of-refactoring","htmlText":"A Touch of Refactoring"}],"lineInfo":{"truncatedLoc":"460","truncatedSloc":"364"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":false,"newDiscussionPath":"/rust-lang/book/discussions/new","newIssuePath":"/rust-lang/book/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/rust-lang/book/blob/main/src/ch20-01-single-threaded.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/rust-lang/book/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h2 tabindex=\"-1\" id=\"user-content-building-a-single-threaded-web-server\" dir=\"auto\"><a class=\"heading-link\" href=\"#building-a-single-threaded-web-server\">Building a Single-Threaded Web Server<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">We’ll start by getting a single-threaded web server working. Before we begin,\nlet’s look at a quick overview of the protocols involved in building web\nservers. The details of these protocols are beyond the scope of this book, but\na brief overview will give you the information you need.</p>\n<p dir=\"auto\">The two main protocols involved in web servers are <em>Hypertext Transfer\nProtocol</em> <em>(HTTP)</em> and <em>Transmission Control Protocol</em> <em>(TCP)</em>. Both protocols\nare <em>request-response</em> protocols, meaning a <em>client</em> initiates requests and a\n<em>server</em> listens to the requests and provides a response to the client. The\ncontents of those requests and responses are defined by the protocols.</p>\n<p dir=\"auto\">TCP is the lower-level protocol that describes the details of how information\ngets from one server to another but doesn’t specify what that information is.\nHTTP builds on top of TCP by defining the contents of the requests and\nresponses. It’s technically possible to use HTTP with other protocols, but in\nthe vast majority of cases, HTTP sends its data over TCP. We’ll work with the\nraw bytes of TCP and HTTP requests and responses.</p>\n<h3 tabindex=\"-1\" id=\"user-content-listening-to-the-tcp-connection\" dir=\"auto\"><a class=\"heading-link\" href=\"#listening-to-the-tcp-connection\">Listening to the TCP Connection<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Our web server needs to listen to a TCP connection, so that’s the first part\nwe’ll work on. The standard library offers a <code>std::net</code> module that lets us do\nthis. Let’s make a new project in the usual fashion:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cargo new hello\n     Created binary (application) `hello` project\n$ cd hello\"><pre>$ <span class=\"pl-s1\">cargo new hello</span>\n<span class=\"pl-c1\">     Created binary (application) `hello` project</span>\n$ <span class=\"pl-s1\"><span class=\"pl-c1\">cd</span> hello</span></pre></div>\n<p dir=\"auto\">Now enter the code in Listing 20-1 in <em>src/main.rs</em> to start. This code will\nlisten at the local address <code>127.0.0.1:7878</code> for incoming TCP streams. When it\ngets an incoming stream, it will print <code>Connection established!</code>.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-01/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">01</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-1: Listening for incoming streams and printing\na message when we receive a stream</span></p>\n<p dir=\"auto\">Using <code>TcpListener</code>, we can listen for TCP connections at the address\n<code>127.0.0.1:7878</code>. In the address, the section before the colon is an IP address\nrepresenting your computer (this is the same on every computer and doesn’t\nrepresent the authors’ computer specifically), and <code>7878</code> is the port. We’ve\nchosen this port for two reasons: HTTP isn’t normally accepted on this port so\nour server is unlikely to conflict with any other web server you might have\nrunning on your machine, and 7878 is <em>rust</em> typed on a telephone.</p>\n<p dir=\"auto\">The <code>bind</code> function in this scenario works like the <code>new</code> function in that it\nwill return a new <code>TcpListener</code> instance. The function is called <code>bind</code>\nbecause, in networking, connecting to a port to listen to is known as “binding\nto a port.”</p>\n<p dir=\"auto\">The <code>bind</code> function returns a <code>Result&lt;T, E&gt;</code>, which indicates that it’s\npossible for binding to fail. For example, connecting to port 80 requires\nadministrator privileges (nonadministrators can listen only on ports higher\nthan 1023), so if we tried to connect to port 80 without being an\nadministrator, binding wouldn’t work. Binding also wouldn’t work, for example,\nif we ran two instances of our program and so had two programs listening to the\nsame port. Because we’re writing a basic server just for learning purposes, we\nwon’t worry about handling these kinds of errors; instead, we use <code>unwrap</code> to\nstop the program if errors happen.</p>\n<p dir=\"auto\">The <code>incoming</code> method on <code>TcpListener</code> returns an iterator that gives us a\nsequence of streams (more specifically, streams of type <code>TcpStream</code>). A single\n<em>stream</em> represents an open connection between the client and the server. A\n<em>connection</em> is the name for the full request and response process in which a\nclient connects to the server, the server generates a response, and the server\ncloses the connection. As such, we will read from the <code>TcpStream</code> to see what\nthe client sent and then write our response to the stream to send data back to\nthe client. Overall, this <code>for</code> loop will process each connection in turn and\nproduce a series of streams for us to handle.</p>\n<p dir=\"auto\">For now, our handling of the stream consists of calling <code>unwrap</code> to terminate\nour program if the stream has any errors; if there aren’t any errors, the\nprogram prints a message. We’ll add more functionality for the success case in\nthe next listing. The reason we might receive errors from the <code>incoming</code> method\nwhen a client connects to the server is that we’re not actually iterating over\nconnections. Instead, we’re iterating over <em>connection attempts</em>. The\nconnection might not be successful for a number of reasons, many of them\noperating system specific. For example, many operating systems have a limit to\nthe number of simultaneous open connections they can support; new connection\nattempts beyond that number will produce an error until some of the open\nconnections are closed.</p>\n<p dir=\"auto\">Let’s try running this code! Invoke <code>cargo run</code> in the terminal and then load\n<em>127.0.0.1:7878</em> in a web browser. The browser should show an error message\nlike “Connection reset,” because the server isn’t currently sending back any\ndata. But when you look at your terminal, you should see several messages that\nwere printed when the browser connected to the server!</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"     Running `target/debug/hello`\nConnection established!\nConnection established!\nConnection established!\"><pre lang=\"text\" class=\"notranslate\"><code>     Running `target/debug/hello`\nConnection established!\nConnection established!\nConnection established!\n</code></pre></div>\n<p dir=\"auto\">Sometimes, you’ll see multiple messages printed for one browser request; the\nreason might be that the browser is making a request for the page as well as a\nrequest for other resources, like the <em>favicon.ico</em> icon that appears in the\nbrowser tab.</p>\n<p dir=\"auto\">It could also be that the browser is trying to connect to the server multiple\ntimes because the server isn’t responding with any data. When <code>stream</code> goes out\nof scope and is dropped at the end of the loop, the connection is closed as\npart of the <code>drop</code> implementation. Browsers sometimes deal with closed\nconnections by retrying, because the problem might be temporary. The important\nfactor is that we’ve successfully gotten a handle to a TCP connection!</p>\n<p dir=\"auto\">Remember to stop the program by pressing <span>ctrl-c</span>\nwhen you’re done running a particular version of the code. Then restart the\nprogram by invoking the <code>cargo run</code> command after you’ve made each set of code\nchanges to make sure you’re running the newest code.</p>\n<h3 tabindex=\"-1\" id=\"user-content-reading-the-request\" dir=\"auto\"><a class=\"heading-link\" href=\"#reading-the-request\">Reading the Request<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Let’s implement the functionality to read the request from the browser! To\nseparate the concerns of first getting a connection and then taking some action\nwith the connection, we’ll start a new function for processing connections. In\nthis new <code>handle_connection</code> function, we’ll read data from the TCP stream and\nprint it so we can see the data being sent from the browser. Change the code to\nlook like Listing 20-2.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-02/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">02</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-2: Reading from the <code>TcpStream</code> and printing\nthe data</span></p>\n<p dir=\"auto\">We bring <code>std::io::prelude</code> and <code>std::io::BufReader</code> into scope to get access\nto traits and types that let us read from and write to the stream. In the <code>for</code>\nloop in the <code>main</code> function, instead of printing a message that says we made a\nconnection, we now call the new <code>handle_connection</code> function and pass the\n<code>stream</code> to it.</p>\n<p dir=\"auto\">In the <code>handle_connection</code> function, we create a new <code>BufReader</code> instance that\nwraps a mutable reference to the <code>stream</code>. <code>BufReader</code> adds buffering by\nmanaging calls to the <code>std::io::Read</code> trait methods for us.</p>\n<p dir=\"auto\">We create a variable named <code>http_request</code> to collect the lines of the request\nthe browser sends to our server. We indicate that we want to collect these\nlines in a vector by adding the <code>Vec&lt;_&gt;</code> type annotation.</p>\n<p dir=\"auto\"><code>BufReader</code> implements the <code>std::io::BufRead</code> trait, which provides the <code>lines</code>\nmethod. The <code>lines</code> method returns an iterator of <code>Result&lt;String, std::io::Error&gt;</code> by splitting the stream of data whenever it sees a newline\nbyte. To get each <code>String</code>, we map and <code>unwrap</code> each <code>Result</code>. The <code>Result</code>\nmight be an error if the data isn’t valid UTF-8 or if there was a problem\nreading from the stream. Again, a production program should handle these errors\nmore gracefully, but we’re choosing to stop the program in the error case for\nsimplicity.</p>\n<p dir=\"auto\">The browser signals the end of an HTTP request by sending two newline\ncharacters in a row, so to get one request from the stream, we take lines until\nwe get a line that is the empty string. Once we’ve collected the lines into the\nvector, we’re printing them out using pretty debug formatting so we can take a\nlook at the instructions the web browser is sending to our server.</p>\n<p dir=\"auto\">Let’s try this code! Start the program and make a request in a web browser\nagain. Note that we’ll still get an error page in the browser, but our\nprogram’s output in the terminal will now look similar to this:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ cargo run\n   Compiling hello v0.1.0 (file:///projects/hello)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.42s\n     Running `target/debug/hello`\nRequest: [\n    &quot;GET / HTTP/1.1&quot;,\n    &quot;Host: 127.0.0.1:7878&quot;,\n    &quot;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:99.0) Gecko/20100101 Firefox/99.0&quot;,\n    &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;,\n    &quot;Accept-Language: en-US,en;q=0.5&quot;,\n    &quot;Accept-Encoding: gzip, deflate, br&quot;,\n    &quot;DNT: 1&quot;,\n    &quot;Connection: keep-alive&quot;,\n    &quot;Upgrade-Insecure-Requests: 1&quot;,\n    &quot;Sec-Fetch-Dest: document&quot;,\n    &quot;Sec-Fetch-Mode: navigate&quot;,\n    &quot;Sec-Fetch-Site: none&quot;,\n    &quot;Sec-Fetch-User: ?1&quot;,\n    &quot;Cache-Control: max-age=0&quot;,\n]\"><pre>$ <span class=\"pl-s1\">cargo run</span>\n<span class=\"pl-c1\">   Compiling hello v0.1.0 (file:///projects/hello)</span>\n<span class=\"pl-c1\">    Finished dev [unoptimized + debuginfo] target(s) in 0.42s</span>\n<span class=\"pl-c1\">     Running `target/debug/hello`</span>\n<span class=\"pl-c1\">Request: [</span>\n<span class=\"pl-c1\">    \"GET / HTTP/1.1\",</span>\n<span class=\"pl-c1\">    \"Host: 127.0.0.1:7878\",</span>\n<span class=\"pl-c1\">    \"User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:99.0) Gecko/20100101 Firefox/99.0\",</span>\n<span class=\"pl-c1\">    \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\",</span>\n<span class=\"pl-c1\">    \"Accept-Language: en-US,en;q=0.5\",</span>\n<span class=\"pl-c1\">    \"Accept-Encoding: gzip, deflate, br\",</span>\n<span class=\"pl-c1\">    \"DNT: 1\",</span>\n<span class=\"pl-c1\">    \"Connection: keep-alive\",</span>\n<span class=\"pl-c1\">    \"Upgrade-Insecure-Requests: 1\",</span>\n<span class=\"pl-c1\">    \"Sec-Fetch-Dest: document\",</span>\n<span class=\"pl-c1\">    \"Sec-Fetch-Mode: navigate\",</span>\n<span class=\"pl-c1\">    \"Sec-Fetch-Site: none\",</span>\n<span class=\"pl-c1\">    \"Sec-Fetch-User: ?1\",</span>\n<span class=\"pl-c1\">    \"Cache-Control: max-age=0\",</span>\n<span class=\"pl-c1\">]</span></pre></div>\n<p dir=\"auto\">Depending on your browser, you might get slightly different output. Now that\nwe’re printing the request data, we can see why we get multiple connections\nfrom one browser request by looking at the path after <code>GET</code> in the first line\nof the request. If the repeated connections are all requesting <em>/</em>, we know the\nbrowser is trying to fetch <em>/</em> repeatedly because it’s not getting a response\nfrom our program.</p>\n<p dir=\"auto\">Let’s break down this request data to understand what the browser is asking of\nour program.</p>\n<h3 tabindex=\"-1\" id=\"user-content-a-closer-look-at-an-http-request\" dir=\"auto\"><a class=\"heading-link\" href=\"#a-closer-look-at-an-http-request\">A Closer Look at an HTTP Request<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">HTTP is a text-based protocol, and a request takes this format:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Method Request-URI HTTP-Version CRLF\nheaders CRLF\nmessage-body\"><pre lang=\"text\" class=\"notranslate\"><code>Method Request-URI HTTP-Version CRLF\nheaders CRLF\nmessage-body\n</code></pre></div>\n<p dir=\"auto\">The first line is the <em>request line</em> that holds information about what the\nclient is requesting. The first part of the request line indicates the <em>method</em>\nbeing used, such as <code>GET</code> or <code>POST</code>, which describes how the client is making\nthis request. Our client used a <code>GET</code> request, which means it is asking for\ninformation.</p>\n<p dir=\"auto\">The next part of the request line is <em>/</em>, which indicates the <em>Uniform Resource\nIdentifier</em> <em>(URI)</em> the client is requesting: a URI is almost, but not quite,\nthe same as a <em>Uniform Resource Locator</em> <em>(URL)</em>. The difference between URIs\nand URLs isn’t important for our purposes in this chapter, but the HTTP spec\nuses the term URI, so we can just mentally substitute URL for URI here.</p>\n<p dir=\"auto\">The last part is the HTTP version the client uses, and then the request line\nends in a <em>CRLF sequence</em>. (CRLF stands for <em>carriage return</em> and <em>line feed</em>,\nwhich are terms from the typewriter days!) The CRLF sequence can also be\nwritten as <code>\\r\\n</code>, where <code>\\r</code> is a carriage return and <code>\\n</code> is a line feed. The\nCRLF sequence separates the request line from the rest of the request data.\nNote that when the CRLF is printed, we see a new line start rather than <code>\\r\\n</code>.</p>\n<p dir=\"auto\">Looking at the request line data we received from running our program so far,\nwe see that <code>GET</code> is the method, <em>/</em> is the request URI, and <code>HTTP/1.1</code> is the\nversion.</p>\n<p dir=\"auto\">After the request line, the remaining lines starting from <code>Host:</code> onward are\nheaders. <code>GET</code> requests have no body.</p>\n<p dir=\"auto\">Try making a request from a different browser or asking for a different\naddress, such as <em>127.0.0.1:7878/test</em>, to see how the request data changes.</p>\n<p dir=\"auto\">Now that we know what the browser is asking for, let’s send back some data!</p>\n<h3 tabindex=\"-1\" id=\"user-content-writing-a-response\" dir=\"auto\"><a class=\"heading-link\" href=\"#writing-a-response\">Writing a Response<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">We’re going to implement sending data in response to a client request.\nResponses have the following format:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"HTTP-Version Status-Code Reason-Phrase CRLF\nheaders CRLF\nmessage-body\"><pre lang=\"text\" class=\"notranslate\"><code>HTTP-Version Status-Code Reason-Phrase CRLF\nheaders CRLF\nmessage-body\n</code></pre></div>\n<p dir=\"auto\">The first line is a <em>status line</em> that contains the HTTP version used in the\nresponse, a numeric status code that summarizes the result of the request, and\na reason phrase that provides a text description of the status code. After the\nCRLF sequence are any headers, another CRLF sequence, and the body of the\nresponse.</p>\n<p dir=\"auto\">Here is an example response that uses HTTP version 1.1, has a status code of\n200, an OK reason phrase, no headers, and no body:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"HTTP/1.1 200 OK\\r\\n\\r\\n\"><pre lang=\"text\" class=\"notranslate\"><code>HTTP/1.1 200 OK\\r\\n\\r\\n\n</code></pre></div>\n<p dir=\"auto\">The status code 200 is the standard success response. The text is a tiny\nsuccessful HTTP response. Let’s write this to the stream as our response to a\nsuccessful request! From the <code>handle_connection</code> function, remove the\n<code>println!</code> that was printing the request data and replace it with the code in\nListing 20-3.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-03/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">03</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-3: Writing a tiny successful HTTP response to\nthe stream</span></p>\n<p dir=\"auto\">The first new line defines the <code>response</code> variable that holds the success\nmessage’s data. Then we call <code>as_bytes</code> on our <code>response</code> to convert the string\ndata to bytes. The <code>write_all</code> method on <code>stream</code> takes a <code>&amp;[u8]</code> and sends\nthose bytes directly down the connection. Because the <code>write_all</code> operation\ncould fail, we use <code>unwrap</code> on any error result as before. Again, in a real\napplication you would add error handling here.</p>\n<p dir=\"auto\">With these changes, let’s run our code and make a request. We’re no longer\nprinting any data to the terminal, so we won’t see any output other than the\noutput from Cargo. When you load <em>127.0.0.1:7878</em> in a web browser, you should\nget a blank page instead of an error. You’ve just hand-coded receiving an HTTP\nrequest and sending a response!</p>\n<h3 tabindex=\"-1\" id=\"user-content-returning-real-html\" dir=\"auto\"><a class=\"heading-link\" href=\"#returning-real-html\">Returning Real HTML<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Let’s implement the functionality for returning more than a blank page. Create\nthe new file <em>hello.html</em> in the root of your project directory, not in the\n<em>src</em> directory. You can input any HTML you want; Listing 20-4 shows one\npossibility.</p>\n<p dir=\"auto\"><span>Filename: hello.html</span></p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch20-web-server/listing-20-05/hello.html}}\"><pre>{{#include ../listings/ch20-web-server/listing-20-05/hello.html}}</pre></div>\n<p dir=\"auto\"><span>Listing 20-4: A sample HTML file to return in a\nresponse</span></p>\n<p dir=\"auto\">This is a minimal HTML5 document with a heading and some text. To return this\nfrom the server when a request is received, we’ll modify <code>handle_connection</code> as\nshown in Listing 20-5 to read the HTML file, add it to the response as a body,\nand send it.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-05/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">05</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-5: Sending the contents of <em>hello.html</em> as the\nbody of the response</span></p>\n<p dir=\"auto\">We’ve added <code>fs</code> to the <code>use</code> statement to bring the standard library’s\nfilesystem module into scope. The code for reading the contents of a file to a\nstring should look familiar; we used it in Chapter 12 when we read the contents\nof a file for our I/O project in Listing 12-4.</p>\n<p dir=\"auto\">Next, we use <code>format!</code> to add the file’s contents as the body of the success\nresponse. To ensure a valid HTTP response, we add the <code>Content-Length</code> header\nwhich is set to the size of our response body, in this case the size of\n<code>hello.html</code>.</p>\n<p dir=\"auto\">Run this code with <code>cargo run</code> and load <em>127.0.0.1:7878</em> in your browser; you\nshould see your HTML rendered!</p>\n<p dir=\"auto\">Currently, we’re ignoring the request data in <code>http_request</code> and just sending\nback the contents of the HTML file unconditionally. That means if you try\nrequesting <em>127.0.0.1:7878/something-else</em> in your browser, you’ll still get\nback this same HTML response. At the moment, our server is very limited and\ndoes not do what most web servers do. We want to customize our responses\ndepending on the request and only send back the HTML file for a well-formed\nrequest to <em>/</em>.</p>\n<h3 tabindex=\"-1\" id=\"user-content-validating-the-request-and-selectively-responding\" dir=\"auto\"><a class=\"heading-link\" href=\"#validating-the-request-and-selectively-responding\">Validating the Request and Selectively Responding<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Right now, our web server will return the HTML in the file no matter what the\nclient requested. Let’s add functionality to check that the browser is\nrequesting <em>/</em> before returning the HTML file and return an error if the\nbrowser requests anything else. For this we need to modify <code>handle_connection</code>,\nas shown in Listing 20-6. This new code checks the content of the request\nreceived against what we know a request for <em>/</em> looks like and adds <code>if</code> and\n<code>else</code> blocks to treat requests differently.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-06/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">06</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-6: Handling requests to <em>/</em> differently from\nother requests</span></p>\n<p dir=\"auto\">We’re only going to be looking at the first line of the HTTP request, so rather\nthan reading the entire request into a vector, we’re calling <code>next</code> to get the\nfirst item from the iterator. The first <code>unwrap</code> takes care of the <code>Option</code> and\nstops the program if the iterator has no items. The second <code>unwrap</code> handles the\n<code>Result</code> and has the same effect as the <code>unwrap</code> that was in the <code>map</code> added in\nListing 20-2.</p>\n<p dir=\"auto\">Next, we check the <code>request_line</code> to see if it equals the request line of a GET\nrequest to the <em>/</em> path. If it does, the <code>if</code> block returns the contents of our\nHTML file.</p>\n<p dir=\"auto\">If the <code>request_line</code> does <em>not</em> equal the GET request to the <em>/</em> path, it\nmeans we’ve received some other request. We’ll add code to the <code>else</code> block in\na moment to respond to all other requests.</p>\n<p dir=\"auto\">Run this code now and request <em>127.0.0.1:7878</em>; you should get the HTML in\n<em>hello.html</em>. If you make any other request, such as\n<em>127.0.0.1:7878/something-else</em>, you’ll get a connection error like those you\nsaw when running the code in Listing 20-1 and Listing 20-2.</p>\n<p dir=\"auto\">Now let’s add the code in Listing 20-7 to the <code>else</code> block to return a response\nwith the status code 404, which signals that the content for the request was\nnot found. We’ll also return some HTML for a page to render in the browser\nindicating the response to the end user.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-07/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">07</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-7: Responding with status code 404 and an\nerror page if anything other than <em>/</em> was requested</span></p>\n<p dir=\"auto\">Here, our response has a status line with status code 404 and the reason phrase\n<code>NOT FOUND</code>. The body of the response will be the HTML in the file <em>404.html</em>.\nYou’ll need to create a <em>404.html</em> file next to <em>hello.html</em> for the error\npage; again feel free to use any HTML you want or use the example HTML in\nListing 20-8.</p>\n<p dir=\"auto\"><span>Filename: 404.html</span></p>\n<div class=\"highlight highlight-text-html-basic notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch20-web-server/listing-20-07/404.html}}\"><pre>{{#include ../listings/ch20-web-server/listing-20-07/404.html}}</pre></div>\n<p dir=\"auto\"><span>Listing 20-8: Sample content for the page to send back\nwith any 404 response</span></p>\n<p dir=\"auto\">With these changes, run your server again. Requesting <em>127.0.0.1:7878</em> should\nreturn the contents of <em>hello.html</em>, and any other request, like\n<em>127.0.0.1:7878/foo</em>, should return the error HTML from <em>404.html</em>.</p>\n<h3 tabindex=\"-1\" id=\"user-content-a-touch-of-refactoring\" dir=\"auto\"><a class=\"heading-link\" href=\"#a-touch-of-refactoring\">A Touch of Refactoring<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">At the moment the <code>if</code> and <code>else</code> blocks have a lot of repetition: they’re both\nreading files and writing the contents of the files to the stream. The only\ndifferences are the status line and the filename. Let’s make the code more\nconcise by pulling out those differences into separate <code>if</code> and <code>else</code> lines\nthat will assign the values of the status line and the filename to variables;\nwe can then use those variables unconditionally in the code to read the file\nand write the response. Listing 20-9 shows the resulting code after replacing\nthe large <code>if</code> and <code>else</code> blocks.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch20-web-server/listing-20-09/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch20-web-server/listing-<span class=\"pl-c1\">20</span>-<span class=\"pl-c1\">09</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 20-9: Refactoring the <code>if</code> and <code>else</code> blocks to\ncontain only the code that differs between the two cases</span></p>\n<p dir=\"auto\">Now the <code>if</code> and <code>else</code> blocks only return the appropriate values for the\nstatus line and filename in a tuple; we then use destructuring to assign these\ntwo values to <code>status_line</code> and <code>filename</code> using a pattern in the <code>let</code>\nstatement, as discussed in Chapter 18.</p>\n<p dir=\"auto\">The previously duplicated code is now outside the <code>if</code> and <code>else</code> blocks and\nuses the <code>status_line</code> and <code>filename</code> variables. This makes it easier to see\nthe difference between the two cases, and it means we have only one place to\nupdate the code if we want to change how the file reading and response writing\nwork. The behavior of the code in Listing 20-9 will be the same as that in\nListing 20-8.</p>\n<p dir=\"auto\">Awesome! We now have a simple web server in approximately 40 lines of Rust code\nthat responds to one request with a page of content and responds to all other\nrequests with a 404 response.</p>\n<p dir=\"auto\">Currently, our server runs in a single thread, meaning it can only serve one\nrequest at a time. Let’s examine how that can be a problem by simulating some\nslow requests. Then we’ll fix it so our server can handle multiple requests at\nonce.</p>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"rust-lang","repoName":"book","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":true,"symbols":[]}},"copilotInfo":null,"csrf_tokens":{"/rust-lang/book/branches":{"post":"y72aC22Ukb1m2SpzRNdpOP6N_NN7AeekHuYMHSp6klBP2Ok_yXQUGMuMweCYBTqdIUenQ4d5ba-i6qwwhQSyQA"},"/repos/preferences":{"post":"OjXz0aO5VZtx46kLDty3DUBmRdQQWUeb1wH-pc1VFXkRZMdlIA9XDqVpl6hz3U6klapNGp2swXBzjbPMeC5W6Q"}}},"title":"book/src/ch20-01-single-threaded.md at main · rust-lang/book"}