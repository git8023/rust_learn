{"payload":{"allShortcutsEnabled":false,"fileTree":{"src":{"items":[{"name":"img","path":"src/img","contentType":"directory"},{"name":"SUMMARY.md","path":"src/SUMMARY.md","contentType":"file"},{"name":"appendix-00.md","path":"src/appendix-00.md","contentType":"file"},{"name":"appendix-01-keywords.md","path":"src/appendix-01-keywords.md","contentType":"file"},{"name":"appendix-02-operators.md","path":"src/appendix-02-operators.md","contentType":"file"},{"name":"appendix-03-derivable-traits.md","path":"src/appendix-03-derivable-traits.md","contentType":"file"},{"name":"appendix-04-useful-development-tools.md","path":"src/appendix-04-useful-development-tools.md","contentType":"file"},{"name":"appendix-05-editions.md","path":"src/appendix-05-editions.md","contentType":"file"},{"name":"appendix-06-translation.md","path":"src/appendix-06-translation.md","contentType":"file"},{"name":"appendix-07-nightly-rust.md","path":"src/appendix-07-nightly-rust.md","contentType":"file"},{"name":"ch00-00-introduction.md","path":"src/ch00-00-introduction.md","contentType":"file"},{"name":"ch01-00-getting-started.md","path":"src/ch01-00-getting-started.md","contentType":"file"},{"name":"ch01-01-installation.md","path":"src/ch01-01-installation.md","contentType":"file"},{"name":"ch01-02-hello-world.md","path":"src/ch01-02-hello-world.md","contentType":"file"},{"name":"ch01-03-hello-cargo.md","path":"src/ch01-03-hello-cargo.md","contentType":"file"},{"name":"ch02-00-guessing-game-tutorial.md","path":"src/ch02-00-guessing-game-tutorial.md","contentType":"file"},{"name":"ch03-00-common-programming-concepts.md","path":"src/ch03-00-common-programming-concepts.md","contentType":"file"},{"name":"ch03-01-variables-and-mutability.md","path":"src/ch03-01-variables-and-mutability.md","contentType":"file"},{"name":"ch03-02-data-types.md","path":"src/ch03-02-data-types.md","contentType":"file"},{"name":"ch03-03-how-functions-work.md","path":"src/ch03-03-how-functions-work.md","contentType":"file"},{"name":"ch03-04-comments.md","path":"src/ch03-04-comments.md","contentType":"file"},{"name":"ch03-05-control-flow.md","path":"src/ch03-05-control-flow.md","contentType":"file"},{"name":"ch04-00-understanding-ownership.md","path":"src/ch04-00-understanding-ownership.md","contentType":"file"},{"name":"ch04-01-what-is-ownership.md","path":"src/ch04-01-what-is-ownership.md","contentType":"file"},{"name":"ch04-02-references-and-borrowing.md","path":"src/ch04-02-references-and-borrowing.md","contentType":"file"},{"name":"ch04-03-slices.md","path":"src/ch04-03-slices.md","contentType":"file"},{"name":"ch05-00-structs.md","path":"src/ch05-00-structs.md","contentType":"file"},{"name":"ch05-01-defining-structs.md","path":"src/ch05-01-defining-structs.md","contentType":"file"},{"name":"ch05-02-example-structs.md","path":"src/ch05-02-example-structs.md","contentType":"file"},{"name":"ch05-03-method-syntax.md","path":"src/ch05-03-method-syntax.md","contentType":"file"},{"name":"ch06-00-enums.md","path":"src/ch06-00-enums.md","contentType":"file"},{"name":"ch06-01-defining-an-enum.md","path":"src/ch06-01-defining-an-enum.md","contentType":"file"},{"name":"ch06-02-match.md","path":"src/ch06-02-match.md","contentType":"file"},{"name":"ch06-03-if-let.md","path":"src/ch06-03-if-let.md","contentType":"file"},{"name":"ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","path":"src/ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","contentType":"file"},{"name":"ch07-01-packages-and-crates.md","path":"src/ch07-01-packages-and-crates.md","contentType":"file"},{"name":"ch07-02-defining-modules-to-control-scope-and-privacy.md","path":"src/ch07-02-defining-modules-to-control-scope-and-privacy.md","contentType":"file"},{"name":"ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","path":"src/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","contentType":"file"},{"name":"ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","path":"src/ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","contentType":"file"},{"name":"ch07-05-separating-modules-into-different-files.md","path":"src/ch07-05-separating-modules-into-different-files.md","contentType":"file"},{"name":"ch08-00-common-collections.md","path":"src/ch08-00-common-collections.md","contentType":"file"},{"name":"ch08-01-vectors.md","path":"src/ch08-01-vectors.md","contentType":"file"},{"name":"ch08-02-strings.md","path":"src/ch08-02-strings.md","contentType":"file"},{"name":"ch08-03-hash-maps.md","path":"src/ch08-03-hash-maps.md","contentType":"file"},{"name":"ch09-00-error-handling.md","path":"src/ch09-00-error-handling.md","contentType":"file"},{"name":"ch09-01-unrecoverable-errors-with-panic.md","path":"src/ch09-01-unrecoverable-errors-with-panic.md","contentType":"file"},{"name":"ch09-02-recoverable-errors-with-result.md","path":"src/ch09-02-recoverable-errors-with-result.md","contentType":"file"},{"name":"ch09-03-to-panic-or-not-to-panic.md","path":"src/ch09-03-to-panic-or-not-to-panic.md","contentType":"file"},{"name":"ch10-00-generics.md","path":"src/ch10-00-generics.md","contentType":"file"},{"name":"ch10-01-syntax.md","path":"src/ch10-01-syntax.md","contentType":"file"},{"name":"ch10-02-traits.md","path":"src/ch10-02-traits.md","contentType":"file"},{"name":"ch10-03-lifetime-syntax.md","path":"src/ch10-03-lifetime-syntax.md","contentType":"file"},{"name":"ch11-00-testing.md","path":"src/ch11-00-testing.md","contentType":"file"},{"name":"ch11-01-writing-tests.md","path":"src/ch11-01-writing-tests.md","contentType":"file"},{"name":"ch11-02-running-tests.md","path":"src/ch11-02-running-tests.md","contentType":"file"},{"name":"ch11-03-test-organization.md","path":"src/ch11-03-test-organization.md","contentType":"file"},{"name":"ch12-00-an-io-project.md","path":"src/ch12-00-an-io-project.md","contentType":"file"},{"name":"ch12-01-accepting-command-line-arguments.md","path":"src/ch12-01-accepting-command-line-arguments.md","contentType":"file"},{"name":"ch12-02-reading-a-file.md","path":"src/ch12-02-reading-a-file.md","contentType":"file"},{"name":"ch12-03-improving-error-handling-and-modularity.md","path":"src/ch12-03-improving-error-handling-and-modularity.md","contentType":"file"},{"name":"ch12-04-testing-the-librarys-functionality.md","path":"src/ch12-04-testing-the-librarys-functionality.md","contentType":"file"},{"name":"ch12-05-working-with-environment-variables.md","path":"src/ch12-05-working-with-environment-variables.md","contentType":"file"},{"name":"ch12-06-writing-to-stderr-instead-of-stdout.md","path":"src/ch12-06-writing-to-stderr-instead-of-stdout.md","contentType":"file"},{"name":"ch13-00-functional-features.md","path":"src/ch13-00-functional-features.md","contentType":"file"},{"name":"ch13-01-closures.md","path":"src/ch13-01-closures.md","contentType":"file"},{"name":"ch13-02-iterators.md","path":"src/ch13-02-iterators.md","contentType":"file"},{"name":"ch13-03-improving-our-io-project.md","path":"src/ch13-03-improving-our-io-project.md","contentType":"file"},{"name":"ch13-04-performance.md","path":"src/ch13-04-performance.md","contentType":"file"},{"name":"ch14-00-more-about-cargo.md","path":"src/ch14-00-more-about-cargo.md","contentType":"file"},{"name":"ch14-01-release-profiles.md","path":"src/ch14-01-release-profiles.md","contentType":"file"},{"name":"ch14-02-publishing-to-crates-io.md","path":"src/ch14-02-publishing-to-crates-io.md","contentType":"file"},{"name":"ch14-03-cargo-workspaces.md","path":"src/ch14-03-cargo-workspaces.md","contentType":"file"},{"name":"ch14-04-installing-binaries.md","path":"src/ch14-04-installing-binaries.md","contentType":"file"},{"name":"ch14-05-extending-cargo.md","path":"src/ch14-05-extending-cargo.md","contentType":"file"},{"name":"ch15-00-smart-pointers.md","path":"src/ch15-00-smart-pointers.md","contentType":"file"},{"name":"ch15-01-box.md","path":"src/ch15-01-box.md","contentType":"file"},{"name":"ch15-02-deref.md","path":"src/ch15-02-deref.md","contentType":"file"},{"name":"ch15-03-drop.md","path":"src/ch15-03-drop.md","contentType":"file"},{"name":"ch15-04-rc.md","path":"src/ch15-04-rc.md","contentType":"file"},{"name":"ch15-05-interior-mutability.md","path":"src/ch15-05-interior-mutability.md","contentType":"file"},{"name":"ch15-06-reference-cycles.md","path":"src/ch15-06-reference-cycles.md","contentType":"file"},{"name":"ch16-00-concurrency.md","path":"src/ch16-00-concurrency.md","contentType":"file"},{"name":"ch16-01-threads.md","path":"src/ch16-01-threads.md","contentType":"file"},{"name":"ch16-02-message-passing.md","path":"src/ch16-02-message-passing.md","contentType":"file"},{"name":"ch16-03-shared-state.md","path":"src/ch16-03-shared-state.md","contentType":"file"},{"name":"ch16-04-extensible-concurrency-sync-and-send.md","path":"src/ch16-04-extensible-concurrency-sync-and-send.md","contentType":"file"},{"name":"ch17-00-oop.md","path":"src/ch17-00-oop.md","contentType":"file"},{"name":"ch17-01-what-is-oo.md","path":"src/ch17-01-what-is-oo.md","contentType":"file"},{"name":"ch17-02-trait-objects.md","path":"src/ch17-02-trait-objects.md","contentType":"file"},{"name":"ch17-03-oo-design-patterns.md","path":"src/ch17-03-oo-design-patterns.md","contentType":"file"},{"name":"ch18-00-patterns.md","path":"src/ch18-00-patterns.md","contentType":"file"},{"name":"ch18-01-all-the-places-for-patterns.md","path":"src/ch18-01-all-the-places-for-patterns.md","contentType":"file"},{"name":"ch18-02-refutability.md","path":"src/ch18-02-refutability.md","contentType":"file"},{"name":"ch18-03-pattern-syntax.md","path":"src/ch18-03-pattern-syntax.md","contentType":"file"},{"name":"ch19-00-advanced-features.md","path":"src/ch19-00-advanced-features.md","contentType":"file"},{"name":"ch19-01-unsafe-rust.md","path":"src/ch19-01-unsafe-rust.md","contentType":"file"},{"name":"ch19-03-advanced-traits.md","path":"src/ch19-03-advanced-traits.md","contentType":"file"},{"name":"ch19-04-advanced-types.md","path":"src/ch19-04-advanced-types.md","contentType":"file"},{"name":"ch19-05-advanced-functions-and-closures.md","path":"src/ch19-05-advanced-functions-and-closures.md","contentType":"file"},{"name":"ch19-06-macros.md","path":"src/ch19-06-macros.md","contentType":"file"},{"name":"ch20-00-final-project-a-web-server.md","path":"src/ch20-00-final-project-a-web-server.md","contentType":"file"},{"name":"ch20-01-single-threaded.md","path":"src/ch20-01-single-threaded.md","contentType":"file"},{"name":"ch20-02-multithreaded.md","path":"src/ch20-02-multithreaded.md","contentType":"file"},{"name":"ch20-03-graceful-shutdown-and-cleanup.md","path":"src/ch20-03-graceful-shutdown-and-cleanup.md","contentType":"file"},{"name":"foreword.md","path":"src/foreword.md","contentType":"file"},{"name":"title-page.md","path":"src/title-page.md","contentType":"file"}],"totalCount":106},"":{"items":[{"name":".cargo","path":".cargo","contentType":"directory"},{"name":".github","path":".github","contentType":"directory"},{"name":"2018-edition","path":"2018-edition","contentType":"directory"},{"name":"ci","path":"ci","contentType":"directory"},{"name":"dot","path":"dot","contentType":"directory"},{"name":"first-edition","path":"first-edition","contentType":"directory"},{"name":"listings","path":"listings","contentType":"directory"},{"name":"nostarch","path":"nostarch","contentType":"directory"},{"name":"redirects","path":"redirects","contentType":"directory"},{"name":"second-edition","path":"second-edition","contentType":"directory"},{"name":"src","path":"src","contentType":"directory"},{"name":"theme","path":"theme","contentType":"directory"},{"name":"tools","path":"tools","contentType":"directory"},{"name":".gitattributes","path":".gitattributes","contentType":"file"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":"ADMIN_TASKS.md","path":"ADMIN_TASKS.md","contentType":"file"},{"name":"CONTRIBUTING.md","path":"CONTRIBUTING.md","contentType":"file"},{"name":"COPYRIGHT","path":"COPYRIGHT","contentType":"file"},{"name":"Cargo.lock","path":"Cargo.lock","contentType":"file"},{"name":"Cargo.toml","path":"Cargo.toml","contentType":"file"},{"name":"LICENSE-APACHE","path":"LICENSE-APACHE","contentType":"file"},{"name":"LICENSE-MIT","path":"LICENSE-MIT","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"TODO.md","path":"TODO.md","contentType":"file"},{"name":"book.toml","path":"book.toml","contentType":"file"},{"name":"ferris.css","path":"ferris.css","contentType":"file"},{"name":"ferris.js","path":"ferris.js","contentType":"file"},{"name":"rust-toolchain","path":"rust-toolchain","contentType":"file"},{"name":"rustfmt.toml","path":"rustfmt.toml","contentType":"file"},{"name":"style-guide.md","path":"style-guide.md","contentType":"file"}],"totalCount":30}},"fileTreeProcessingTime":16.541823,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":47854924,"defaultBranch":"main","name":"book","ownerLogin":"rust-lang","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2015-12-11T22:49:49.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/5430905?v=4","public":true,"private":false,"isOrgOwned":true},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1688046669.0","canEdit":false,"refType":"branch","currentOid":"72187f5cd0beaaa9c6f584156bcd88f921871e83"},"path":"src/ch09-02-recoverable-errors-with-result.md","currentUser":null,"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/rust-lang/book/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/rust-lang/book/security/dependabot","repoSecurityAndAnalysisPath":"/rust-lang/book/settings/security_analysis","repoOwnerIsOrg":true,"currentUserCanAdminRepo":false},"displayName":"ch09-02-recoverable-errors-with-result.md","displayUrl":"https://github.com/rust-lang/book/blob/main/src/ch09-02-recoverable-errors-with-result.md?raw=true","headerInfo":{"blobSize":"25.7 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"2ee006f","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Fbook%2Fblob%2Fmain%2Fsrc%2Fch09-02-recoverable-errors-with-result.md","isCSV":false,"isRichtext":true,"toc":[{"level":2,"text":"Recoverable Errors with Result","anchor":"recoverable-errors-with-result","htmlText":"Recoverable Errors with Result"},{"level":3,"text":"Matching on Different Errors","anchor":"matching-on-different-errors","htmlText":"Matching on Different Errors"},{"level":3,"text":"Alternatives to Using match with Result<T, E>","anchor":"alternatives-to-using-match-with-resultt-e","htmlText":"Alternatives to Using match with Result&lt;T, E&gt;"},{"level":3,"text":"Shortcuts for Panic on Error: unwrap and expect","anchor":"shortcuts-for-panic-on-error-unwrap-and-expect","htmlText":"Shortcuts for Panic on Error: unwrap and expect"},{"level":3,"text":"Propagating Errors","anchor":"propagating-errors","htmlText":"Propagating Errors"},{"level":4,"text":"A Shortcut for Propagating Errors: the ? Operator","anchor":"a-shortcut-for-propagating-errors-the--operator","htmlText":"A Shortcut for Propagating Errors: the ? Operator"},{"level":4,"text":"Where The ? Operator Can Be Used","anchor":"where-the--operator-can-be-used","htmlText":"Where The ? Operator Can Be Used"}],"lineInfo":{"truncatedLoc":"537","truncatedSloc":"435"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":false,"newDiscussionPath":"/rust-lang/book/discussions/new","newIssuePath":"/rust-lang/book/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/rust-lang/book/blob/main/src/ch09-02-recoverable-errors-with-result.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/rust-lang/book/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h2 tabindex=\"-1\" id=\"user-content-recoverable-errors-with-result\" dir=\"auto\"><a class=\"heading-link\" href=\"#recoverable-errors-with-result\">Recoverable Errors with <code>Result</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">Most errors aren’t serious enough to require the program to stop entirely.\nSometimes, when a function fails, it’s for a reason that you can easily\ninterpret and respond to. For example, if you try to open a file and that\noperation fails because the file doesn’t exist, you might want to create the\nfile instead of terminating the process.</p>\n<p dir=\"auto\">Recall from <a href=\"/rust-lang/book/blob/main/src/ch02-00-guessing-game-tutorial.html#handling-potential-failure-with-result\">“Handling Potential Failure with <code>Result</code>”</a> in Chapter 2 that the <code>Result</code> enum is defined as having two\nvariants, <code>Ok</code> and <code>Err</code>, as follows:</p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"enum Result&lt;T, E&gt; {\n    Ok(T),\n    Err(E),\n}\"><pre><span class=\"pl-k\">enum</span> <span class=\"pl-smi\">Result</span><span class=\"pl-kos\">&lt;</span><span class=\"pl-smi\">T</span><span class=\"pl-kos\">,</span> <span class=\"pl-smi\">E</span><span class=\"pl-kos\">&gt;</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-v\">Ok</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">T</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-v\">Err</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">E</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n<span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">The <code>T</code> and <code>E</code> are generic type parameters: we’ll discuss generics in more\ndetail in Chapter 10. What you need to know right now is that <code>T</code> represents\nthe type of the value that will be returned in a success case within the <code>Ok</code>\nvariant, and <code>E</code> represents the type of the error that will be returned in a\nfailure case within the <code>Err</code> variant. Because <code>Result</code> has these generic type\nparameters, we can use the <code>Result</code> type and the functions defined on it in\nmany different situations where the successful value and error value we want to\nreturn may differ.</p>\n<p dir=\"auto\">Let’s call a function that returns a <code>Result</code> value because the function could\nfail. In Listing 9-3 we try to open a file.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-03/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">03</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-3: Opening a file</span></p>\n<p dir=\"auto\">The return type of <code>File::open</code> is a <code>Result&lt;T, E&gt;</code>. The generic parameter <code>T</code>\nhas been filled in by the implementation of <code>File::open</code> with the type of the\nsuccess value, <code>std::fs::File</code>, which is a file handle. The type of <code>E</code> used in\nthe error value is <code>std::io::Error</code>. This return type means the call to\n<code>File::open</code> might succeed and return a file handle that we can read from or\nwrite to. The function call also might fail: for example, the file might not\nexist, or we might not have permission to access the file. The <code>File::open</code>\nfunction needs to have a way to tell us whether it succeeded or failed and at\nthe same time give us either the file handle or error information. This\ninformation is exactly what the <code>Result</code> enum conveys.</p>\n<p dir=\"auto\">In the case where <code>File::open</code> succeeds, the value in the variable\n<code>greeting_file_result</code> will be an instance of <code>Ok</code> that contains a file handle.\nIn the case where it fails, the value in <code>greeting_file_result</code> will be an\ninstance of <code>Err</code> that contains more information about the kind of error that\nhappened.</p>\n<p dir=\"auto\">We need to add to the code in Listing 9-3 to take different actions depending\non the value <code>File::open</code> returns. Listing 9-4 shows one way to handle the\n<code>Result</code> using a basic tool, the <code>match</code> expression that we discussed in\nChapter 6.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-04/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">04</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-4: Using a <code>match</code> expression to handle the\n<code>Result</code> variants that might be returned</span></p>\n<p dir=\"auto\">Note that, like the <code>Option</code> enum, the <code>Result</code> enum and its variants have been\nbrought into scope by the prelude, so we don’t need to specify <code>Result::</code>\nbefore the <code>Ok</code> and <code>Err</code> variants in the <code>match</code> arms.</p>\n<p dir=\"auto\">When the result is <code>Ok</code>, this code will return the inner <code>file</code> value out of\nthe <code>Ok</code> variant, and we then assign that file handle value to the variable\n<code>greeting_file</code>. After the <code>match</code>, we can use the file handle for reading or\nwriting.</p>\n<p dir=\"auto\">The other arm of the <code>match</code> handles the case where we get an <code>Err</code> value from\n<code>File::open</code>. In this example, we’ve chosen to call the <code>panic!</code> macro. If\nthere’s no file named <em>hello.txt</em> in our current directory and we run this\ncode, we’ll see the following output from the <code>panic!</code> macro:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-04/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch09-error-handling/listing-09-04/output.txt}}</span></pre></div>\n<p dir=\"auto\">As usual, this output tells us exactly what has gone wrong.</p>\n<h3 tabindex=\"-1\" id=\"user-content-matching-on-different-errors\" dir=\"auto\"><a class=\"heading-link\" href=\"#matching-on-different-errors\">Matching on Different Errors<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">The code in Listing 9-4 will <code>panic!</code> no matter why <code>File::open</code> failed.\nHowever, we want to take different actions for different failure reasons: if\n<code>File::open</code> failed because the file doesn’t exist, we want to create the file\nand return the handle to the new file. If <code>File::open</code> failed for any other\nreason—for example, because we didn’t have permission to open the file—we still\nwant the code to <code>panic!</code> in the same way as it did in Listing 9-4. For this we\nadd an inner <code>match</code> expression, shown in Listing 9-5.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-05/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">05</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-5: Handling different kinds of errors in\ndifferent ways</span></p>\n<p dir=\"auto\">The type of the value that <code>File::open</code> returns inside the <code>Err</code> variant is\n<code>io::Error</code>, which is a struct provided by the standard library. This struct\nhas a method <code>kind</code> that we can call to get an <code>io::ErrorKind</code> value. The enum\n<code>io::ErrorKind</code> is provided by the standard library and has variants\nrepresenting the different kinds of errors that might result from an <code>io</code>\noperation. The variant we want to use is <code>ErrorKind::NotFound</code>, which indicates\nthe file we’re trying to open doesn’t exist yet. So we match on\n<code>greeting_file_result</code>, but we also have an inner match on <code>error.kind()</code>.</p>\n<p dir=\"auto\">The condition we want to check in the inner match is whether the value returned\nby <code>error.kind()</code> is the <code>NotFound</code> variant of the <code>ErrorKind</code> enum. If it is,\nwe try to create the file with <code>File::create</code>. However, because <code>File::create</code>\ncould also fail, we need a second arm in the inner <code>match</code> expression. When the\nfile can’t be created, a different error message is printed. The second arm of\nthe outer <code>match</code> stays the same, so the program panics on any error besides\nthe missing file error.</p>\n<blockquote>\n<h3 tabindex=\"-1\" id=\"user-content-alternatives-to-using-match-with-resultt-e\" dir=\"auto\"><a class=\"heading-link\" href=\"#alternatives-to-using-match-with-resultt-e\">Alternatives to Using <code>match</code> with <code>Result&lt;T, E&gt;</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">That’s a lot of <code>match</code>! The <code>match</code> expression is very useful but also very\nmuch a primitive. In Chapter 13, you’ll learn about closures, which are used\nwith many of the methods defined on <code>Result&lt;T, E&gt;</code>. These methods can be more\nconcise than using <code>match</code> when handling <code>Result&lt;T, E&gt;</code> values in your code.</p>\n<p dir=\"auto\">For example, here’s another way to write the same logic as shown in Listing\n9-5, this time using closures and the <code>unwrap_or_else</code> method:</p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"use std::fs::File;\nuse std::io::ErrorKind;\n\nfn main() {\n    let greeting_file = File::open(&quot;hello.txt&quot;).unwrap_or_else(|error| {\n        if error.kind() == ErrorKind::NotFound {\n            File::create(&quot;hello.txt&quot;).unwrap_or_else(|error| {\n                panic!(&quot;Problem creating the file: {:?}&quot;, error);\n            })\n        } else {\n            panic!(&quot;Problem opening the file: {:?}&quot;, error);\n        }\n    });\n}\"><pre><span class=\"pl-k\">use</span> std<span class=\"pl-kos\">::</span>fs<span class=\"pl-kos\">::</span><span class=\"pl-v\">File</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-k\">use</span> std<span class=\"pl-kos\">::</span>io<span class=\"pl-kos\">::</span><span class=\"pl-v\">ErrorKind</span><span class=\"pl-kos\">;</span>\n\n<span class=\"pl-k\">fn</span> <span class=\"pl-en\">main</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-k\">let</span> greeting_file = <span class=\"pl-smi\">File</span><span class=\"pl-kos\">::</span><span class=\"pl-en\">open</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"hello.txt\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unwrap_or_else</span><span class=\"pl-kos\">(</span>|error| <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">if</span> error<span class=\"pl-kos\">.</span><span class=\"pl-en\">kind</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> == <span class=\"pl-smi\">ErrorKind</span><span class=\"pl-kos\">::</span><span class=\"pl-v\">NotFound</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-smi\">File</span><span class=\"pl-kos\">::</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"hello.txt\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unwrap_or_else</span><span class=\"pl-kos\">(</span>|error| <span class=\"pl-kos\">{</span>\n                <span class=\"pl-en\">panic</span><span class=\"pl-en\">!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"Problem creating the file: {:?}\"</span>, error<span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n            <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-kos\">}</span> <span class=\"pl-k\">else</span> <span class=\"pl-kos\">{</span>\n            <span class=\"pl-en\">panic</span><span class=\"pl-en\">!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"Problem opening the file: {:?}\"</span>, error<span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-kos\">}</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n<span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">Although this code has the same behavior as Listing 9-5, it doesn’t contain\nany <code>match</code> expressions and is cleaner to read. Come back to this example\nafter you’ve read Chapter 13, and look up the <code>unwrap_or_else</code> method in the\nstandard library documentation. Many more of these methods can clean up huge\nnested <code>match</code> expressions when you’re dealing with errors.</p>\n</blockquote>\n<h3 tabindex=\"-1\" id=\"user-content-shortcuts-for-panic-on-error-unwrap-and-expect\" dir=\"auto\"><a class=\"heading-link\" href=\"#shortcuts-for-panic-on-error-unwrap-and-expect\">Shortcuts for Panic on Error: <code>unwrap</code> and <code>expect</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Using <code>match</code> works well enough, but it can be a bit verbose and doesn’t always\ncommunicate intent well. The <code>Result&lt;T, E&gt;</code> type has many helper methods\ndefined on it to do various, more specific tasks. The <code>unwrap</code> method is a\nshortcut method implemented just like the <code>match</code> expression we wrote in\nListing 9-4. If the <code>Result</code> value is the <code>Ok</code> variant, <code>unwrap</code> will return\nthe value inside the <code>Ok</code>. If the <code>Result</code> is the <code>Err</code> variant, <code>unwrap</code> will\ncall the <code>panic!</code> macro for us. Here is an example of <code>unwrap</code> in action:</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/no-listing-04-unwrap/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/no-listing-<span class=\"pl-c1\">04</span>-unwrap/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">If we run this code without a <em>hello.txt</em> file, we’ll see an error message from\nthe <code>panic!</code> call that the <code>unwrap</code> method makes:</p>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Os {\ncode: 2, kind: NotFound, message: &quot;No such file or directory&quot; }',\nsrc/main.rs:4:49\"><pre lang=\"text\" class=\"notranslate\"><code>thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Os {\ncode: 2, kind: NotFound, message: \"No such file or directory\" }',\nsrc/main.rs:4:49\n</code></pre></div>\n<p dir=\"auto\">Similarly, the <code>expect</code> method lets us also choose the <code>panic!</code> error message.\nUsing <code>expect</code> instead of <code>unwrap</code> and providing good error messages can convey\nyour intent and make tracking down the source of a panic easier. The syntax of\n<code>expect</code> looks like this:</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/no-listing-05-expect/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/no-listing-<span class=\"pl-c1\">05</span>-expect/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">We use <code>expect</code> in the same way as <code>unwrap</code>: to return the file handle or call\nthe <code>panic!</code> macro. The error message used by <code>expect</code> in its call to <code>panic!</code>\nwill be the parameter that we pass to <code>expect</code>, rather than the default\n<code>panic!</code> message that <code>unwrap</code> uses. Here’s what it looks like:</p>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"thread 'main' panicked at 'hello.txt should be included in this project: Os {\ncode: 2, kind: NotFound, message: &quot;No such file or directory&quot; }',\nsrc/main.rs:5:10\"><pre lang=\"text\" class=\"notranslate\"><code>thread 'main' panicked at 'hello.txt should be included in this project: Os {\ncode: 2, kind: NotFound, message: \"No such file or directory\" }',\nsrc/main.rs:5:10\n</code></pre></div>\n<p dir=\"auto\">In production-quality code, most Rustaceans choose <code>expect</code> rather than\n<code>unwrap</code> and give more context about why the operation is expected to always\nsucceed. That way, if your assumptions are ever proven wrong, you have more\ninformation to use in debugging.</p>\n<h3 tabindex=\"-1\" id=\"user-content-propagating-errors\" dir=\"auto\"><a class=\"heading-link\" href=\"#propagating-errors\">Propagating Errors<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">When a function’s implementation calls something that might fail, instead of\nhandling the error within the function itself, you can return the error to the\ncalling code so that it can decide what to do. This is known as <em>propagating</em>\nthe error and gives more control to the calling code, where there might be more\ninformation or logic that dictates how the error should be handled than what\nyou have available in the context of your code.</p>\n<p dir=\"auto\">For example, Listing 9-6 shows a function that reads a username from a file. If\nthe file doesn’t exist or can’t be read, this function will return those errors\nto the code that called the function.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-06/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">06</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-6: A function that returns errors to the\ncalling code using <code>match</code></span></p>\n<p dir=\"auto\">This function can be written in a much shorter way, but we’re going to start by\ndoing a lot of it manually in order to explore error handling; at the end,\nwe’ll show the shorter way. Let’s look at the return type of the function\nfirst: <code>Result&lt;String, io::Error&gt;</code>. This means the function is returning a\nvalue of the type <code>Result&lt;T, E&gt;</code> where the generic parameter <code>T</code> has been\nfilled in with the concrete type <code>String</code>, and the generic type <code>E</code> has been\nfilled in with the concrete type <code>io::Error</code>.</p>\n<p dir=\"auto\">If this function succeeds without any problems, the code that calls this\nfunction will receive an <code>Ok</code> value that holds a <code>String</code>—the username that\nthis function read from the file. If this function encounters any problems, the\ncalling code will receive an <code>Err</code> value that holds an instance of <code>io::Error</code>\nthat contains more information about what the problems were. We chose\n<code>io::Error</code> as the return type of this function because that happens to be the\ntype of the error value returned from both of the operations we’re calling in\nthis function’s body that might fail: the <code>File::open</code> function and the\n<code>read_to_string</code> method.</p>\n<p dir=\"auto\">The body of the function starts by calling the <code>File::open</code> function. Then we\nhandle the <code>Result</code> value with a <code>match</code> similar to the <code>match</code> in Listing 9-4.\nIf <code>File::open</code> succeeds, the file handle in the pattern variable <code>file</code>\nbecomes the value in the mutable variable <code>username_file</code> and the function\ncontinues. In the <code>Err</code> case, instead of calling <code>panic!</code>, we use the <code>return</code>\nkeyword to return early out of the function entirely and pass the error value\nfrom <code>File::open</code>, now in the pattern variable <code>e</code>, back to the calling code as\nthis function’s error value.</p>\n<p dir=\"auto\">So if we have a file handle in <code>username_file</code>, the function then creates a new\n<code>String</code> in variable <code>username</code> and calls the <code>read_to_string</code> method on\nthe file handle in <code>username_file</code> to read the contents of the file into\n<code>username</code>. The <code>read_to_string</code> method also returns a <code>Result</code> because it\nmight fail, even though <code>File::open</code> succeeded. So we need another <code>match</code> to\nhandle that <code>Result</code>: if <code>read_to_string</code> succeeds, then our function has\nsucceeded, and we return the username from the file that’s now in <code>username</code>\nwrapped in an <code>Ok</code>. If <code>read_to_string</code> fails, we return the error value in the\nsame way that we returned the error value in the <code>match</code> that handled the\nreturn value of <code>File::open</code>. However, we don’t need to explicitly say\n<code>return</code>, because this is the last expression in the function.</p>\n<p dir=\"auto\">The code that calls this code will then handle getting either an <code>Ok</code> value\nthat contains a username or an <code>Err</code> value that contains an <code>io::Error</code>. It’s\nup to the calling code to decide what to do with those values. If the calling\ncode gets an <code>Err</code> value, it could call <code>panic!</code> and crash the program, use a\ndefault username, or look up the username from somewhere other than a file, for\nexample. We don’t have enough information on what the calling code is actually\ntrying to do, so we propagate all the success or error information upward for\nit to handle appropriately.</p>\n<p dir=\"auto\">This pattern of propagating errors is so common in Rust that Rust provides the\nquestion mark operator <code>?</code> to make this easier.</p>\n<h4 tabindex=\"-1\" id=\"user-content-a-shortcut-for-propagating-errors-the--operator\" dir=\"auto\"><a class=\"heading-link\" href=\"#a-shortcut-for-propagating-errors-the--operator\">A Shortcut for Propagating Errors: the <code>?</code> Operator<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">Listing 9-7 shows an implementation of <code>read_username_from_file</code> that has the\nsame functionality as in Listing 9-6, but this implementation uses the\n<code>?</code> operator.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-07/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">07</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-7: A function that returns errors to the\ncalling code using the <code>?</code> operator</span></p>\n<p dir=\"auto\">The <code>?</code> placed after a <code>Result</code> value is defined to work in almost the same way\nas the <code>match</code> expressions we defined to handle the <code>Result</code> values in Listing\n9-6. If the value of the <code>Result</code> is an <code>Ok</code>, the value inside the <code>Ok</code> will\nget returned from this expression, and the program will continue. If the value\nis an <code>Err</code>, the <code>Err</code> will be returned from the whole function as if we had\nused the <code>return</code> keyword so the error value gets propagated to the calling\ncode.</p>\n<p dir=\"auto\">There is a difference between what the <code>match</code> expression from Listing 9-6 does\nand what the <code>?</code> operator does: error values that have the <code>?</code> operator called\non them go through the <code>from</code> function, defined in the <code>From</code> trait in the\nstandard library, which is used to convert values from one type into another.\nWhen the <code>?</code> operator calls the <code>from</code> function, the error type received is\nconverted into the error type defined in the return type of the current\nfunction. This is useful when a function returns one error type to represent\nall the ways a function might fail, even if parts might fail for many different\nreasons.</p>\n<p dir=\"auto\">For example, we could change the <code>read_username_from_file</code> function in Listing\n9-7 to return a custom error type named <code>OurError</code> that we define. If we also\ndefine <code>impl From&lt;io::Error&gt; for OurError</code> to construct an instance of\n<code>OurError</code> from an <code>io::Error</code>, then the <code>?</code> operator calls in the body of\n<code>read_username_from_file</code> will call <code>from</code> and convert the error types without\nneeding to add any more code to the function.</p>\n<p dir=\"auto\">In the context of Listing 9-7, the <code>?</code> at the end of the <code>File::open</code> call will\nreturn the value inside an <code>Ok</code> to the variable <code>username_file</code>. If an error\noccurs, the <code>?</code> operator will return early out of the whole function and give\nany <code>Err</code> value to the calling code. The same thing applies to the <code>?</code> at the\nend of the <code>read_to_string</code> call.</p>\n<p dir=\"auto\">The <code>?</code> operator eliminates a lot of boilerplate and makes this function’s\nimplementation simpler. We could even shorten this code further by chaining\nmethod calls immediately after the <code>?</code>, as shown in Listing 9-8.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-08/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">08</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-8: Chaining method calls after the <code>?</code>\noperator</span></p>\n<p dir=\"auto\">We’ve moved the creation of the new <code>String</code> in <code>username</code> to the beginning of\nthe function; that part hasn’t changed. Instead of creating a variable\n<code>username_file</code>, we’ve chained the call to <code>read_to_string</code> directly onto the\nresult of <code>File::open(\"hello.txt\")?</code>. We still have a <code>?</code> at the end of the\n<code>read_to_string</code> call, and we still return an <code>Ok</code> value containing <code>username</code>\nwhen both <code>File::open</code> and <code>read_to_string</code> succeed rather than returning\nerrors. The functionality is again the same as in Listing 9-6 and Listing 9-7;\nthis is just a different, more ergonomic way to write it.</p>\n<p dir=\"auto\">Listing 9-9 shows a way to make this even shorter using <code>fs::read_to_string</code>.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-09/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">09</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-9: Using <code>fs::read_to_string</code> instead of\nopening and then reading the file</span></p>\n<p dir=\"auto\">Reading a file into a string is a fairly common operation, so the standard\nlibrary provides the convenient <code>fs::read_to_string</code> function that opens the\nfile, creates a new <code>String</code>, reads the contents of the file, puts the contents\ninto that <code>String</code>, and returns it. Of course, using <code>fs::read_to_string</code>\ndoesn’t give us the opportunity to explain all the error handling, so we did it\nthe longer way first.</p>\n<h4 tabindex=\"-1\" id=\"user-content-where-the--operator-can-be-used\" dir=\"auto\"><a class=\"heading-link\" href=\"#where-the--operator-can-be-used\">Where The <code>?</code> Operator Can Be Used<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">The <code>?</code> operator can only be used in functions whose return type is compatible\nwith the value the <code>?</code> is used on. This is because the <code>?</code> operator is defined\nto perform an early return of a value out of the function, in the same manner\nas the <code>match</code> expression we defined in Listing 9-6. In Listing 9-6, the\n<code>match</code> was using a <code>Result</code> value, and the early return arm returned an\n<code>Err(e)</code> value. The return type of the function has to be a <code>Result</code> so that\nit’s compatible with this <code>return</code>.</p>\n<p dir=\"auto\">In Listing 9-10, let’s look at the error we’ll get if we use the <code>?</code> operator\nin a <code>main</code> function with a return type incompatible with the type of the value\nwe use <code>?</code> on:</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-10/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">10</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-10: Attempting to use the <code>?</code> in the <code>main</code>\nfunction that returns <code>()</code> won’t compile</span></p>\n<p dir=\"auto\">This code opens a file, which might fail. The <code>?</code> operator follows the <code>Result</code>\nvalue returned by <code>File::open</code>, but this <code>main</code> function has the return type of\n<code>()</code>, not <code>Result</code>. When we compile this code, we get the following error\nmessage:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch09-error-handling/listing-09-10/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch09-error-handling/listing-09-10/output.txt}}</span></pre></div>\n<p dir=\"auto\">This error points out that we’re only allowed to use the <code>?</code> operator in a\nfunction that returns <code>Result</code>, <code>Option</code>, or another type that implements\n<code>FromResidual</code>.</p>\n<p dir=\"auto\">To fix the error, you have two choices. One choice is to change the return type\nof your function to be compatible with the value you’re using the <code>?</code> operator\non as long as you have no restrictions preventing that. The other technique is\nto use a <code>match</code> or one of the <code>Result&lt;T, E&gt;</code> methods to handle the <code>Result&lt;T, E&gt;</code> in whatever way is appropriate.</p>\n<p dir=\"auto\">The error message also mentioned that <code>?</code> can be used with <code>Option&lt;T&gt;</code> values\nas well. As with using <code>?</code> on <code>Result</code>, you can only use <code>?</code> on <code>Option</code> in a\nfunction that returns an <code>Option</code>. The behavior of the <code>?</code> operator when called\non an <code>Option&lt;T&gt;</code> is similar to its behavior when called on a <code>Result&lt;T, E&gt;</code>:\nif the value is <code>None</code>, the <code>None</code> will be returned early from the function at\nthat point. If the value is <code>Some</code>, the value inside the <code>Some</code> is the\nresulting value of the expression and the function continues. Listing 9-11 has\nan example of a function that finds the last character of the first line in the\ngiven text:</p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-11/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">11</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-11: Using the <code>?</code> operator on an <code>Option&lt;T&gt;</code>\nvalue</span></p>\n<p dir=\"auto\">This function returns <code>Option&lt;char&gt;</code> because it’s possible that there is a\ncharacter there, but it’s also possible that there isn’t. This code takes the\n<code>text</code> string slice argument and calls the <code>lines</code> method on it, which returns\nan iterator over the lines in the string. Because this function wants to\nexamine the first line, it calls <code>next</code> on the iterator to get the first value\nfrom the iterator. If <code>text</code> is the empty string, this call to <code>next</code> will\nreturn <code>None</code>, in which case we use <code>?</code> to stop and return <code>None</code> from\n<code>last_char_of_first_line</code>. If <code>text</code> is not the empty string, <code>next</code> will\nreturn a <code>Some</code> value containing a string slice of the first line in <code>text</code>.</p>\n<p dir=\"auto\">The <code>?</code> extracts the string slice, and we can call <code>chars</code> on that string slice\nto get an iterator of its characters. We’re interested in the last character in\nthis first line, so we call <code>last</code> to return the last item in the iterator.\nThis is an <code>Option</code> because it’s possible that the first line is the empty\nstring, for example if <code>text</code> starts with a blank line but has characters on\nother lines, as in <code>\"\\nhi\"</code>. However, if there is a last character on the first\nline, it will be returned in the <code>Some</code> variant. The <code>?</code> operator in the middle\ngives us a concise way to express this logic, allowing us to implement the\nfunction in one line. If we couldn’t use the <code>?</code> operator on <code>Option</code>, we’d\nhave to implement this logic using more method calls or a <code>match</code> expression.</p>\n<p dir=\"auto\">Note that you can use the <code>?</code> operator on a <code>Result</code> in a function that returns\n<code>Result</code>, and you can use the <code>?</code> operator on an <code>Option</code> in a function that\nreturns <code>Option</code>, but you can’t mix and match. The <code>?</code> operator won’t\nautomatically convert a <code>Result</code> to an <code>Option</code> or vice versa; in those cases,\nyou can use methods like the <code>ok</code> method on <code>Result</code> or the <code>ok_or</code> method on\n<code>Option</code> to do the conversion explicitly.</p>\n<p dir=\"auto\">So far, all the <code>main</code> functions we’ve used return <code>()</code>. The <code>main</code> function is\nspecial because it’s the entry and exit point of executable programs, and there\nare restrictions on what its return type can be for the programs to behave as\nexpected.</p>\n<p dir=\"auto\">Luckily, <code>main</code> can also return a <code>Result&lt;(), E&gt;</code>. Listing 9-12 has the\ncode from Listing 9-10 but we’ve changed the return type of <code>main</code> to be\n<code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code> and added a return value <code>Ok(())</code> to the end. This\ncode will now compile:</p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch09-error-handling/listing-09-12/src/main.rs}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch09-error-handling/listing-<span class=\"pl-c1\">09</span>-<span class=\"pl-c1\">12</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 9-12: Changing <code>main</code> to return <code>Result&lt;(), E&gt;</code>\nallows the use of the <code>?</code> operator on <code>Result</code> values</span></p>\n<p dir=\"auto\">The <code>Box&lt;dyn Error&gt;</code> type is a <em>trait object</em>, which we’ll talk about in the\n<a href=\"/rust-lang/book/blob/main/src/ch17-02-trait-objects.html#using-trait-objects-that-allow-for-values-of-different-types\">“Using Trait Objects that Allow for Values of Different\nTypes”</a> section in Chapter 17. For now, you can\nread <code>Box&lt;dyn Error&gt;</code> to mean “any kind of error.” Using <code>?</code> on a <code>Result</code>\nvalue in a <code>main</code> function with the error type <code>Box&lt;dyn Error&gt;</code> is allowed,\nbecause it allows any <code>Err</code> value to be returned early. Even though the body of\nthis <code>main</code> function will only ever return errors of type <code>std::io::Error</code>, by\nspecifying <code>Box&lt;dyn Error&gt;</code>, this signature will continue to be correct even if\nmore code that returns other errors is added to the body of <code>main</code>.</p>\n<p dir=\"auto\">When a <code>main</code> function returns a <code>Result&lt;(), E&gt;</code>, the executable will\nexit with a value of <code>0</code> if <code>main</code> returns <code>Ok(())</code> and will exit with a\nnonzero value if <code>main</code> returns an <code>Err</code> value. Executables written in C return\nintegers when they exit: programs that exit successfully return the integer\n<code>0</code>, and programs that error return some integer other than <code>0</code>. Rust also\nreturns integers from executables to be compatible with this convention.</p>\n<p dir=\"auto\">The <code>main</code> function may return any types that implement <a href=\"/rust-lang/book/blob/main/std/process/trait.Termination.html\">the\n<code>std::process::Termination</code> trait</a>, which contains\na function <code>report</code> that returns an <code>ExitCode</code>. Consult the standard library\ndocumentation for more information on implementing the <code>Termination</code> trait for\nyour own types.</p>\n<p dir=\"auto\">Now that we’ve discussed the details of calling <code>panic!</code> or returning <code>Result</code>,\nlet’s return to the topic of how to decide which is appropriate to use in which\ncases.</p>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"rust-lang","repoName":"book","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":true,"symbols":[]}},"copilotInfo":null,"csrf_tokens":{"/rust-lang/book/branches":{"post":"4dZcpGJitUj7xlzdaamxC4Rga2CzCdN72hsSZJmhWldJjS9lSNupl8ZD9wgZWJZNE-Mn479LKIzYqqwCIG08Og"},"/repos/preferences":{"post":"9lBJkEcIfpQ7zKpuZz5wyvP_wbXBpxibU-LGZ0jzAYkvzKSbjzPPFXhQ0FoPFOLxWcetIrt4OMKicGw5HEYzSw"}}},"title":"book/src/ch09-02-recoverable-errors-with-result.md at main · rust-lang/book"}