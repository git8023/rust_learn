{"payload":{"allShortcutsEnabled":false,"fileTree":{"src":{"items":[{"name":"img","path":"src/img","contentType":"directory"},{"name":"SUMMARY.md","path":"src/SUMMARY.md","contentType":"file"},{"name":"appendix-00.md","path":"src/appendix-00.md","contentType":"file"},{"name":"appendix-01-keywords.md","path":"src/appendix-01-keywords.md","contentType":"file"},{"name":"appendix-02-operators.md","path":"src/appendix-02-operators.md","contentType":"file"},{"name":"appendix-03-derivable-traits.md","path":"src/appendix-03-derivable-traits.md","contentType":"file"},{"name":"appendix-04-useful-development-tools.md","path":"src/appendix-04-useful-development-tools.md","contentType":"file"},{"name":"appendix-05-editions.md","path":"src/appendix-05-editions.md","contentType":"file"},{"name":"appendix-06-translation.md","path":"src/appendix-06-translation.md","contentType":"file"},{"name":"appendix-07-nightly-rust.md","path":"src/appendix-07-nightly-rust.md","contentType":"file"},{"name":"ch00-00-introduction.md","path":"src/ch00-00-introduction.md","contentType":"file"},{"name":"ch01-00-getting-started.md","path":"src/ch01-00-getting-started.md","contentType":"file"},{"name":"ch01-01-installation.md","path":"src/ch01-01-installation.md","contentType":"file"},{"name":"ch01-02-hello-world.md","path":"src/ch01-02-hello-world.md","contentType":"file"},{"name":"ch01-03-hello-cargo.md","path":"src/ch01-03-hello-cargo.md","contentType":"file"},{"name":"ch02-00-guessing-game-tutorial.md","path":"src/ch02-00-guessing-game-tutorial.md","contentType":"file"},{"name":"ch03-00-common-programming-concepts.md","path":"src/ch03-00-common-programming-concepts.md","contentType":"file"},{"name":"ch03-01-variables-and-mutability.md","path":"src/ch03-01-variables-and-mutability.md","contentType":"file"},{"name":"ch03-02-data-types.md","path":"src/ch03-02-data-types.md","contentType":"file"},{"name":"ch03-03-how-functions-work.md","path":"src/ch03-03-how-functions-work.md","contentType":"file"},{"name":"ch03-04-comments.md","path":"src/ch03-04-comments.md","contentType":"file"},{"name":"ch03-05-control-flow.md","path":"src/ch03-05-control-flow.md","contentType":"file"},{"name":"ch04-00-understanding-ownership.md","path":"src/ch04-00-understanding-ownership.md","contentType":"file"},{"name":"ch04-01-what-is-ownership.md","path":"src/ch04-01-what-is-ownership.md","contentType":"file"},{"name":"ch04-02-references-and-borrowing.md","path":"src/ch04-02-references-and-borrowing.md","contentType":"file"},{"name":"ch04-03-slices.md","path":"src/ch04-03-slices.md","contentType":"file"},{"name":"ch05-00-structs.md","path":"src/ch05-00-structs.md","contentType":"file"},{"name":"ch05-01-defining-structs.md","path":"src/ch05-01-defining-structs.md","contentType":"file"},{"name":"ch05-02-example-structs.md","path":"src/ch05-02-example-structs.md","contentType":"file"},{"name":"ch05-03-method-syntax.md","path":"src/ch05-03-method-syntax.md","contentType":"file"},{"name":"ch06-00-enums.md","path":"src/ch06-00-enums.md","contentType":"file"},{"name":"ch06-01-defining-an-enum.md","path":"src/ch06-01-defining-an-enum.md","contentType":"file"},{"name":"ch06-02-match.md","path":"src/ch06-02-match.md","contentType":"file"},{"name":"ch06-03-if-let.md","path":"src/ch06-03-if-let.md","contentType":"file"},{"name":"ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","path":"src/ch07-00-managing-growing-projects-with-packages-crates-and-modules.md","contentType":"file"},{"name":"ch07-01-packages-and-crates.md","path":"src/ch07-01-packages-and-crates.md","contentType":"file"},{"name":"ch07-02-defining-modules-to-control-scope-and-privacy.md","path":"src/ch07-02-defining-modules-to-control-scope-and-privacy.md","contentType":"file"},{"name":"ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","path":"src/ch07-03-paths-for-referring-to-an-item-in-the-module-tree.md","contentType":"file"},{"name":"ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","path":"src/ch07-04-bringing-paths-into-scope-with-the-use-keyword.md","contentType":"file"},{"name":"ch07-05-separating-modules-into-different-files.md","path":"src/ch07-05-separating-modules-into-different-files.md","contentType":"file"},{"name":"ch08-00-common-collections.md","path":"src/ch08-00-common-collections.md","contentType":"file"},{"name":"ch08-01-vectors.md","path":"src/ch08-01-vectors.md","contentType":"file"},{"name":"ch08-02-strings.md","path":"src/ch08-02-strings.md","contentType":"file"},{"name":"ch08-03-hash-maps.md","path":"src/ch08-03-hash-maps.md","contentType":"file"},{"name":"ch09-00-error-handling.md","path":"src/ch09-00-error-handling.md","contentType":"file"},{"name":"ch09-01-unrecoverable-errors-with-panic.md","path":"src/ch09-01-unrecoverable-errors-with-panic.md","contentType":"file"},{"name":"ch09-02-recoverable-errors-with-result.md","path":"src/ch09-02-recoverable-errors-with-result.md","contentType":"file"},{"name":"ch09-03-to-panic-or-not-to-panic.md","path":"src/ch09-03-to-panic-or-not-to-panic.md","contentType":"file"},{"name":"ch10-00-generics.md","path":"src/ch10-00-generics.md","contentType":"file"},{"name":"ch10-01-syntax.md","path":"src/ch10-01-syntax.md","contentType":"file"},{"name":"ch10-02-traits.md","path":"src/ch10-02-traits.md","contentType":"file"},{"name":"ch10-03-lifetime-syntax.md","path":"src/ch10-03-lifetime-syntax.md","contentType":"file"},{"name":"ch11-00-testing.md","path":"src/ch11-00-testing.md","contentType":"file"},{"name":"ch11-01-writing-tests.md","path":"src/ch11-01-writing-tests.md","contentType":"file"},{"name":"ch11-02-running-tests.md","path":"src/ch11-02-running-tests.md","contentType":"file"},{"name":"ch11-03-test-organization.md","path":"src/ch11-03-test-organization.md","contentType":"file"},{"name":"ch12-00-an-io-project.md","path":"src/ch12-00-an-io-project.md","contentType":"file"},{"name":"ch12-01-accepting-command-line-arguments.md","path":"src/ch12-01-accepting-command-line-arguments.md","contentType":"file"},{"name":"ch12-02-reading-a-file.md","path":"src/ch12-02-reading-a-file.md","contentType":"file"},{"name":"ch12-03-improving-error-handling-and-modularity.md","path":"src/ch12-03-improving-error-handling-and-modularity.md","contentType":"file"},{"name":"ch12-04-testing-the-librarys-functionality.md","path":"src/ch12-04-testing-the-librarys-functionality.md","contentType":"file"},{"name":"ch12-05-working-with-environment-variables.md","path":"src/ch12-05-working-with-environment-variables.md","contentType":"file"},{"name":"ch12-06-writing-to-stderr-instead-of-stdout.md","path":"src/ch12-06-writing-to-stderr-instead-of-stdout.md","contentType":"file"},{"name":"ch13-00-functional-features.md","path":"src/ch13-00-functional-features.md","contentType":"file"},{"name":"ch13-01-closures.md","path":"src/ch13-01-closures.md","contentType":"file"},{"name":"ch13-02-iterators.md","path":"src/ch13-02-iterators.md","contentType":"file"},{"name":"ch13-03-improving-our-io-project.md","path":"src/ch13-03-improving-our-io-project.md","contentType":"file"},{"name":"ch13-04-performance.md","path":"src/ch13-04-performance.md","contentType":"file"},{"name":"ch14-00-more-about-cargo.md","path":"src/ch14-00-more-about-cargo.md","contentType":"file"},{"name":"ch14-01-release-profiles.md","path":"src/ch14-01-release-profiles.md","contentType":"file"},{"name":"ch14-02-publishing-to-crates-io.md","path":"src/ch14-02-publishing-to-crates-io.md","contentType":"file"},{"name":"ch14-03-cargo-workspaces.md","path":"src/ch14-03-cargo-workspaces.md","contentType":"file"},{"name":"ch14-04-installing-binaries.md","path":"src/ch14-04-installing-binaries.md","contentType":"file"},{"name":"ch14-05-extending-cargo.md","path":"src/ch14-05-extending-cargo.md","contentType":"file"},{"name":"ch15-00-smart-pointers.md","path":"src/ch15-00-smart-pointers.md","contentType":"file"},{"name":"ch15-01-box.md","path":"src/ch15-01-box.md","contentType":"file"},{"name":"ch15-02-deref.md","path":"src/ch15-02-deref.md","contentType":"file"},{"name":"ch15-03-drop.md","path":"src/ch15-03-drop.md","contentType":"file"},{"name":"ch15-04-rc.md","path":"src/ch15-04-rc.md","contentType":"file"},{"name":"ch15-05-interior-mutability.md","path":"src/ch15-05-interior-mutability.md","contentType":"file"},{"name":"ch15-06-reference-cycles.md","path":"src/ch15-06-reference-cycles.md","contentType":"file"},{"name":"ch16-00-concurrency.md","path":"src/ch16-00-concurrency.md","contentType":"file"},{"name":"ch16-01-threads.md","path":"src/ch16-01-threads.md","contentType":"file"},{"name":"ch16-02-message-passing.md","path":"src/ch16-02-message-passing.md","contentType":"file"},{"name":"ch16-03-shared-state.md","path":"src/ch16-03-shared-state.md","contentType":"file"},{"name":"ch16-04-extensible-concurrency-sync-and-send.md","path":"src/ch16-04-extensible-concurrency-sync-and-send.md","contentType":"file"},{"name":"ch17-00-oop.md","path":"src/ch17-00-oop.md","contentType":"file"},{"name":"ch17-01-what-is-oo.md","path":"src/ch17-01-what-is-oo.md","contentType":"file"},{"name":"ch17-02-trait-objects.md","path":"src/ch17-02-trait-objects.md","contentType":"file"},{"name":"ch17-03-oo-design-patterns.md","path":"src/ch17-03-oo-design-patterns.md","contentType":"file"},{"name":"ch18-00-patterns.md","path":"src/ch18-00-patterns.md","contentType":"file"},{"name":"ch18-01-all-the-places-for-patterns.md","path":"src/ch18-01-all-the-places-for-patterns.md","contentType":"file"},{"name":"ch18-02-refutability.md","path":"src/ch18-02-refutability.md","contentType":"file"},{"name":"ch18-03-pattern-syntax.md","path":"src/ch18-03-pattern-syntax.md","contentType":"file"},{"name":"ch19-00-advanced-features.md","path":"src/ch19-00-advanced-features.md","contentType":"file"},{"name":"ch19-01-unsafe-rust.md","path":"src/ch19-01-unsafe-rust.md","contentType":"file"},{"name":"ch19-03-advanced-traits.md","path":"src/ch19-03-advanced-traits.md","contentType":"file"},{"name":"ch19-04-advanced-types.md","path":"src/ch19-04-advanced-types.md","contentType":"file"},{"name":"ch19-05-advanced-functions-and-closures.md","path":"src/ch19-05-advanced-functions-and-closures.md","contentType":"file"},{"name":"ch19-06-macros.md","path":"src/ch19-06-macros.md","contentType":"file"},{"name":"ch20-00-final-project-a-web-server.md","path":"src/ch20-00-final-project-a-web-server.md","contentType":"file"},{"name":"ch20-01-single-threaded.md","path":"src/ch20-01-single-threaded.md","contentType":"file"},{"name":"ch20-02-multithreaded.md","path":"src/ch20-02-multithreaded.md","contentType":"file"},{"name":"ch20-03-graceful-shutdown-and-cleanup.md","path":"src/ch20-03-graceful-shutdown-and-cleanup.md","contentType":"file"},{"name":"foreword.md","path":"src/foreword.md","contentType":"file"},{"name":"title-page.md","path":"src/title-page.md","contentType":"file"}],"totalCount":106},"":{"items":[{"name":".cargo","path":".cargo","contentType":"directory"},{"name":".github","path":".github","contentType":"directory"},{"name":"2018-edition","path":"2018-edition","contentType":"directory"},{"name":"ci","path":"ci","contentType":"directory"},{"name":"dot","path":"dot","contentType":"directory"},{"name":"first-edition","path":"first-edition","contentType":"directory"},{"name":"listings","path":"listings","contentType":"directory"},{"name":"nostarch","path":"nostarch","contentType":"directory"},{"name":"redirects","path":"redirects","contentType":"directory"},{"name":"second-edition","path":"second-edition","contentType":"directory"},{"name":"src","path":"src","contentType":"directory"},{"name":"theme","path":"theme","contentType":"directory"},{"name":"tools","path":"tools","contentType":"directory"},{"name":".gitattributes","path":".gitattributes","contentType":"file"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":"ADMIN_TASKS.md","path":"ADMIN_TASKS.md","contentType":"file"},{"name":"CONTRIBUTING.md","path":"CONTRIBUTING.md","contentType":"file"},{"name":"COPYRIGHT","path":"COPYRIGHT","contentType":"file"},{"name":"Cargo.lock","path":"Cargo.lock","contentType":"file"},{"name":"Cargo.toml","path":"Cargo.toml","contentType":"file"},{"name":"LICENSE-APACHE","path":"LICENSE-APACHE","contentType":"file"},{"name":"LICENSE-MIT","path":"LICENSE-MIT","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"TODO.md","path":"TODO.md","contentType":"file"},{"name":"book.toml","path":"book.toml","contentType":"file"},{"name":"ferris.css","path":"ferris.css","contentType":"file"},{"name":"ferris.js","path":"ferris.js","contentType":"file"},{"name":"rust-toolchain","path":"rust-toolchain","contentType":"file"},{"name":"rustfmt.toml","path":"rustfmt.toml","contentType":"file"},{"name":"style-guide.md","path":"style-guide.md","contentType":"file"}],"totalCount":30}},"fileTreeProcessingTime":63.359467,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":47854924,"defaultBranch":"main","name":"book","ownerLogin":"rust-lang","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2015-12-11T22:49:49.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/5430905?v=4","public":true,"private":false,"isOrgOwned":true},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1688046669.0","canEdit":false,"refType":"branch","currentOid":"72187f5cd0beaaa9c6f584156bcd88f921871e83"},"path":"src/ch12-03-improving-error-handling-and-modularity.md","currentUser":null,"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/rust-lang/book/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/rust-lang/book/security/dependabot","repoSecurityAndAnalysisPath":"/rust-lang/book/settings/security_analysis","repoOwnerIsOrg":true,"currentUserCanAdminRepo":false},"displayName":"ch12-03-improving-error-handling-and-modularity.md","displayUrl":"https://github.com/rust-lang/book/blob/main/src/ch12-03-improving-error-handling-and-modularity.md?raw=true","headerInfo":{"blobSize":"24.2 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"87e525d","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Fbook%2Fblob%2Fmain%2Fsrc%2Fch12-03-improving-error-handling-and-modularity.md","isCSV":false,"isRichtext":true,"toc":[{"level":2,"text":"Refactoring to Improve Modularity and Error Handling","anchor":"refactoring-to-improve-modularity-and-error-handling","htmlText":"Refactoring to Improve Modularity and Error Handling"},{"level":3,"text":"Separation of Concerns for Binary Projects","anchor":"separation-of-concerns-for-binary-projects","htmlText":"Separation of Concerns for Binary Projects"},{"level":4,"text":"Extracting the Argument Parser","anchor":"extracting-the-argument-parser","htmlText":"Extracting the Argument Parser"},{"level":4,"text":"Grouping Configuration Values","anchor":"grouping-configuration-values","htmlText":"Grouping Configuration Values"},{"level":3,"text":"The Trade-Offs of Using clone","anchor":"the-trade-offs-of-using-clone","htmlText":"The Trade-Offs of Using clone"},{"level":4,"text":"Creating a Constructor for Config","anchor":"creating-a-constructor-for-config","htmlText":"Creating a Constructor for Config"},{"level":3,"text":"Fixing the Error Handling","anchor":"fixing-the-error-handling","htmlText":"Fixing the Error Handling"},{"level":4,"text":"Improving the Error Message","anchor":"improving-the-error-message","htmlText":"Improving the Error Message"},{"level":4,"text":"Returning a Result Instead of Calling panic!","anchor":"returning-a-result-instead-of-calling-panic","htmlText":"Returning a Result Instead of Calling panic!"},{"level":4,"text":"Calling Config::build and Handling Errors","anchor":"calling-configbuild-and-handling-errors","htmlText":"Calling Config::build and Handling Errors"},{"level":3,"text":"Extracting Logic from main","anchor":"extracting-logic-from-main","htmlText":"Extracting Logic from main"},{"level":4,"text":"Returning Errors from the run Function","anchor":"returning-errors-from-the-run-function","htmlText":"Returning Errors from the run Function"},{"level":4,"text":"Handling Errors Returned from run in main","anchor":"handling-errors-returned-from-run-in-main","htmlText":"Handling Errors Returned from run in main"},{"level":3,"text":"Splitting Code into a Library Crate","anchor":"splitting-code-into-a-library-crate","htmlText":"Splitting Code into a Library Crate"}],"lineInfo":{"truncatedLoc":"505","truncatedSloc":"393"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":false,"newDiscussionPath":"/rust-lang/book/discussions/new","newIssuePath":"/rust-lang/book/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/rust-lang/book/blob/main/src/ch12-03-improving-error-handling-and-modularity.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/rust-lang/book/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h2 tabindex=\"-1\" id=\"user-content-refactoring-to-improve-modularity-and-error-handling\" dir=\"auto\"><a class=\"heading-link\" href=\"#refactoring-to-improve-modularity-and-error-handling\">Refactoring to Improve Modularity and Error Handling<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h2>\n<p dir=\"auto\">To improve our program, we’ll fix four problems that have to do with the\nprogram’s structure and how it’s handling potential errors. First, our <code>main</code>\nfunction now performs two tasks: it parses arguments and reads files. As our\nprogram grows, the number of separate tasks the <code>main</code> function handles will\nincrease. As a function gains responsibilities, it becomes more difficult to\nreason about, harder to test, and harder to change without breaking one of its\nparts. It’s best to separate functionality so each function is responsible for\none task.</p>\n<p dir=\"auto\">This issue also ties into the second problem: although <code>query</code> and <code>file_path</code>\nare configuration variables to our program, variables like <code>contents</code> are used\nto perform the program’s logic. The longer <code>main</code> becomes, the more variables\nwe’ll need to bring into scope; the more variables we have in scope, the harder\nit will be to keep track of the purpose of each. It’s best to group the\nconfiguration variables into one structure to make their purpose clear.</p>\n<p dir=\"auto\">The third problem is that we’ve used <code>expect</code> to print an error message when\nreading the file fails, but the error message just prints <code>Should have been able to read the file</code>. Reading a file can fail in a number of ways: for\nexample, the file could be missing, or we might not have permission to open it.\nRight now, regardless of the situation, we’d print the same error message for\neverything, which wouldn’t give the user any information!</p>\n<p dir=\"auto\">Fourth, we use <code>expect</code> repeatedly to handle different errors, and if the user\nruns our program without specifying enough arguments, they’ll get an <code>index out of bounds</code> error from Rust that doesn’t clearly explain the problem. It would\nbe best if all the error-handling code were in one place so future maintainers\nhad only one place to consult the code if the error-handling logic needed to\nchange. Having all the error-handling code in one place will also ensure that\nwe’re printing messages that will be meaningful to our end users.</p>\n<p dir=\"auto\">Let’s address these four problems by refactoring our project.</p>\n<h3 tabindex=\"-1\" id=\"user-content-separation-of-concerns-for-binary-projects\" dir=\"auto\"><a class=\"heading-link\" href=\"#separation-of-concerns-for-binary-projects\">Separation of Concerns for Binary Projects<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">The organizational problem of allocating responsibility for multiple tasks to\nthe <code>main</code> function is common to many binary projects. As a result, the Rust\ncommunity has developed guidelines for splitting the separate concerns of a\nbinary program when <code>main</code> starts getting large. This process has the following\nsteps:</p>\n<ul dir=\"auto\">\n<li>Split your program into a <em>main.rs</em> and a <em>lib.rs</em> and move your program’s\nlogic to <em>lib.rs</em>.</li>\n<li>As long as your command line parsing logic is small, it can remain in\n<em>main.rs</em>.</li>\n<li>When the command line parsing logic starts getting complicated, extract it\nfrom <em>main.rs</em> and move it to <em>lib.rs</em>.</li>\n</ul>\n<p dir=\"auto\">The responsibilities that remain in the <code>main</code> function after this process\nshould be limited to the following:</p>\n<ul dir=\"auto\">\n<li>Calling the command line parsing logic with the argument values</li>\n<li>Setting up any other configuration</li>\n<li>Calling a <code>run</code> function in <em>lib.rs</em></li>\n<li>Handling the error if <code>run</code> returns an error</li>\n</ul>\n<p dir=\"auto\">This pattern is about separating concerns: <em>main.rs</em> handles running the\nprogram, and <em>lib.rs</em> handles all the logic of the task at hand. Because you\ncan’t test the <code>main</code> function directly, this structure lets you test all of\nyour program’s logic by moving it into functions in <em>lib.rs</em>. The code that\nremains in <em>main.rs</em> will be small enough to verify its correctness by reading\nit. Let’s rework our program by following this process.</p>\n<h4 tabindex=\"-1\" id=\"user-content-extracting-the-argument-parser\" dir=\"auto\"><a class=\"heading-link\" href=\"#extracting-the-argument-parser\">Extracting the Argument Parser<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">We’ll extract the functionality for parsing arguments into a function that\n<code>main</code> will call to prepare for moving the command line parsing logic to\n<em>src/lib.rs</em>. Listing 12-5 shows the new start of <code>main</code> that calls a new\nfunction <code>parse_config</code>, which we’ll define in <em>src/main.rs</em> for the moment.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-05/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">05</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-5: Extracting a <code>parse_config</code> function from\n<code>main</code></span></p>\n<p dir=\"auto\">We’re still collecting the command line arguments into a vector, but instead of\nassigning the argument value at index 1 to the variable <code>query</code> and the\nargument value at index 2 to the variable <code>file_path</code> within the <code>main</code>\nfunction, we pass the whole vector to the <code>parse_config</code> function. The\n<code>parse_config</code> function then holds the logic that determines which argument\ngoes in which variable and passes the values back to <code>main</code>. We still create\nthe <code>query</code> and <code>file_path</code> variables in <code>main</code>, but <code>main</code> no longer has the\nresponsibility of determining how the command line arguments and variables\ncorrespond.</p>\n<p dir=\"auto\">This rework may seem like overkill for our small program, but we’re refactoring\nin small, incremental steps. After making this change, run the program again to\nverify that the argument parsing still works. It’s good to check your progress\noften, to help identify the cause of problems when they occur.</p>\n<h4 tabindex=\"-1\" id=\"user-content-grouping-configuration-values\" dir=\"auto\"><a class=\"heading-link\" href=\"#grouping-configuration-values\">Grouping Configuration Values<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">We can take another small step to improve the <code>parse_config</code> function further.\nAt the moment, we’re returning a tuple, but then we immediately break that\ntuple into individual parts again. This is a sign that perhaps we don’t have\nthe right abstraction yet.</p>\n<p dir=\"auto\">Another indicator that shows there’s room for improvement is the <code>config</code> part\nof <code>parse_config</code>, which implies that the two values we return are related and\nare both part of one configuration value. We’re not currently conveying this\nmeaning in the structure of the data other than by grouping the two values into\na tuple; we’ll instead put the two values into one struct and give each of the\nstruct fields a meaningful name. Doing so will make it easier for future\nmaintainers of this code to understand how the different values relate to each\nother and what their purpose is.</p>\n<p dir=\"auto\">Listing 12-6 shows the improvements to the <code>parse_config</code> function.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-06/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">06</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-6: Refactoring <code>parse_config</code> to return an\ninstance of a <code>Config</code> struct</span></p>\n<p dir=\"auto\">We’ve added a struct named <code>Config</code> defined to have fields named <code>query</code> and\n<code>file_path</code>. The signature of <code>parse_config</code> now indicates that it returns a\n<code>Config</code> value. In the body of <code>parse_config</code>, where we used to return\nstring slices that reference <code>String</code> values in <code>args</code>, we now define <code>Config</code>\nto contain owned <code>String</code> values. The <code>args</code> variable in <code>main</code> is the owner of\nthe argument values and is only letting the <code>parse_config</code> function borrow\nthem, which means we’d violate Rust’s borrowing rules if <code>Config</code> tried to take\nownership of the values in <code>args</code>.</p>\n<p dir=\"auto\">There are a number of ways we could manage the <code>String</code> data; the easiest,\nthough somewhat inefficient, route is to call the <code>clone</code> method on the values.\nThis will make a full copy of the data for the <code>Config</code> instance to own, which\ntakes more time and memory than storing a reference to the string data.\nHowever, cloning the data also makes our code very straightforward because we\ndon’t have to manage the lifetimes of the references; in this circumstance,\ngiving up a little performance to gain simplicity is a worthwhile trade-off.</p>\n<blockquote>\n<h3 tabindex=\"-1\" id=\"user-content-the-trade-offs-of-using-clone\" dir=\"auto\"><a class=\"heading-link\" href=\"#the-trade-offs-of-using-clone\">The Trade-Offs of Using <code>clone</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">There’s a tendency among many Rustaceans to avoid using <code>clone</code> to fix\nownership problems because of its runtime cost. In\n<a href=\"/rust-lang/book/blob/main/src/ch13-00-functional-features.html\">Chapter 13</a>, you’ll learn how to use more efficient\nmethods in this type of situation. But for now, it’s okay to copy a few\nstrings to continue making progress because you’ll make these copies only\nonce and your file path and query string are very small. It’s better to have\na working program that’s a bit inefficient than to try to hyperoptimize code\non your first pass. As you become more experienced with Rust, it’ll be\neasier to start with the most efficient solution, but for now, it’s\nperfectly acceptable to call <code>clone</code>.</p>\n</blockquote>\n<p dir=\"auto\">We’ve updated <code>main</code> so it places the instance of <code>Config</code> returned by\n<code>parse_config</code> into a variable named <code>config</code>, and we updated the code that\npreviously used the separate <code>query</code> and <code>file_path</code> variables so it now uses\nthe fields on the <code>Config</code> struct instead.</p>\n<p dir=\"auto\">Now our code more clearly conveys that <code>query</code> and <code>file_path</code> are related and\nthat their purpose is to configure how the program will work. Any code that\nuses these values knows to find them in the <code>config</code> instance in the fields\nnamed for their purpose.</p>\n<h4 tabindex=\"-1\" id=\"user-content-creating-a-constructor-for-config\" dir=\"auto\"><a class=\"heading-link\" href=\"#creating-a-constructor-for-config\">Creating a Constructor for <code>Config</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">So far, we’ve extracted the logic responsible for parsing the command line\narguments from <code>main</code> and placed it in the <code>parse_config</code> function. Doing so\nhelped us to see that the <code>query</code> and <code>file_path</code> values were related and that\nrelationship should be conveyed in our code. We then added a <code>Config</code> struct to\nname the related purpose of <code>query</code> and <code>file_path</code> and to be able to return the\nvalues’ names as struct field names from the <code>parse_config</code> function.</p>\n<p dir=\"auto\">So now that the purpose of the <code>parse_config</code> function is to create a <code>Config</code>\ninstance, we can change <code>parse_config</code> from a plain function to a function\nnamed <code>new</code> that is associated with the <code>Config</code> struct. Making this change\nwill make the code more idiomatic. We can create instances of types in the\nstandard library, such as <code>String</code>, by calling <code>String::new</code>. Similarly, by\nchanging <code>parse_config</code> into a <code>new</code> function associated with <code>Config</code>, we’ll\nbe able to create instances of <code>Config</code> by calling <code>Config::new</code>. Listing 12-7\nshows the changes we need to make.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-07/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">07</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-7: Changing <code>parse_config</code> into\n<code>Config::new</code></span></p>\n<p dir=\"auto\">We’ve updated <code>main</code> where we were calling <code>parse_config</code> to instead call\n<code>Config::new</code>. We’ve changed the name of <code>parse_config</code> to <code>new</code> and moved it\nwithin an <code>impl</code> block, which associates the <code>new</code> function with <code>Config</code>. Try\ncompiling this code again to make sure it works.</p>\n<h3 tabindex=\"-1\" id=\"user-content-fixing-the-error-handling\" dir=\"auto\"><a class=\"heading-link\" href=\"#fixing-the-error-handling\">Fixing the Error Handling<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Now we’ll work on fixing our error handling. Recall that attempting to access\nthe values in the <code>args</code> vector at index 1 or index 2 will cause the program to\npanic if the vector contains fewer than three items. Try running the program\nwithout any arguments; it will look like this:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch12-an-io-project/listing-12-07/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch12-an-io-project/listing-12-07/output.txt}}</span></pre></div>\n<p dir=\"auto\">The line <code>index out of bounds: the len is 1 but the index is 1</code> is an error\nmessage intended for programmers. It won’t help our end users understand what\nthey should do instead. Let’s fix that now.</p>\n<h4 tabindex=\"-1\" id=\"user-content-improving-the-error-message\" dir=\"auto\"><a class=\"heading-link\" href=\"#improving-the-error-message\">Improving the Error Message<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">In Listing 12-8, we add a check in the <code>new</code> function that will verify that the\nslice is long enough before accessing index 1 and 2. If the slice isn’t long\nenough, the program panics and displays a better error message.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-08/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">08</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-8: Adding a check for the number of\narguments</span></p>\n<p dir=\"auto\">This code is similar to <a href=\"/rust-lang/book/blob/main/src/ch09-03-to-panic-or-not-to-panic.html#creating-custom-types-for-validation\">the <code>Guess::new</code> function we wrote in Listing\n9-13</a>, where we called <code>panic!</code> when the\n<code>value</code> argument was out of the range of valid values. Instead of checking for\na range of values here, we’re checking that the length of <code>args</code> is at least 3\nand the rest of the function can operate under the assumption that this\ncondition has been met. If <code>args</code> has fewer than three items, this condition\nwill be true, and we call the <code>panic!</code> macro to end the program immediately.</p>\n<p dir=\"auto\">With these extra few lines of code in <code>new</code>, let’s run the program without any\narguments again to see what the error looks like now:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch12-an-io-project/listing-12-08/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch12-an-io-project/listing-12-08/output.txt}}</span></pre></div>\n<p dir=\"auto\">This output is better: we now have a reasonable error message. However, we also\nhave extraneous information we don’t want to give to our users. Perhaps using\nthe technique we used in Listing 9-13 isn’t the best to use here: a call to\n<code>panic!</code> is more appropriate for a programming problem than a usage problem,\n<a href=\"/rust-lang/book/blob/main/src/ch09-03-to-panic-or-not-to-panic.html#guidelines-for-error-handling\">as discussed in Chapter 9</a>. Instead,\nwe’ll use the other technique you learned about in Chapter 9—<a href=\"/rust-lang/book/blob/main/src/ch09-02-recoverable-errors-with-result.html\">returning a\n<code>Result</code></a> that indicates either success or an error.</p>\n\n<p dir=\"auto\"><a id=\"user-content-returning-a-result-from-new-instead-of-calling-panic\"></a></p>\n<h4 tabindex=\"-1\" id=\"user-content-returning-a-result-instead-of-calling-panic\" dir=\"auto\"><a class=\"heading-link\" href=\"#returning-a-result-instead-of-calling-panic\">Returning a <code>Result</code> Instead of Calling <code>panic!</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">We can instead return a <code>Result</code> value that will contain a <code>Config</code> instance in\nthe successful case and will describe the problem in the error case. We’re also\ngoing to change the function name from <code>new</code> to <code>build</code> because many\nprogrammers expect <code>new</code> functions to never fail. When <code>Config::build</code> is\ncommunicating to <code>main</code>, we can use the <code>Result</code> type to signal there was a\nproblem. Then we can change <code>main</code> to convert an <code>Err</code> variant into a more\npractical error for our users without the surrounding text about <code>thread 'main'</code> and <code>RUST_BACKTRACE</code> that a call to <code>panic!</code> causes.</p>\n<p dir=\"auto\">Listing 12-9 shows the changes we need to make to the return value of the\nfunction we’re now calling <code>Config::build</code> and the body of the function needed\nto return a <code>Result</code>. Note that this won’t compile until we update <code>main</code> as\nwell, which we’ll do in the next listing.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-09/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">09</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-9: Returning a <code>Result</code> from\n<code>Config::build</code></span></p>\n<p dir=\"auto\">Our <code>build</code> function returns a <code>Result</code> with a <code>Config</code> instance in the success\ncase and a <code>&amp;'static str</code> in the error case. Our error values will always be\nstring literals that have the <code>'static</code> lifetime.</p>\n<p dir=\"auto\">We’ve made two changes in the body of the function: instead of calling <code>panic!</code>\nwhen the user doesn’t pass enough arguments, we now return an <code>Err</code> value, and\nwe’ve wrapped the <code>Config</code> return value in an <code>Ok</code>. These changes make the\nfunction conform to its new type signature.</p>\n<p dir=\"auto\">Returning an <code>Err</code> value from <code>Config::build</code> allows the <code>main</code> function to\nhandle the <code>Result</code> value returned from the <code>build</code> function and exit the\nprocess more cleanly in the error case.</p>\n\n<p dir=\"auto\"><a id=\"user-content-calling-confignew-and-handling-errors\"></a></p>\n<h4 tabindex=\"-1\" id=\"user-content-calling-configbuild-and-handling-errors\" dir=\"auto\"><a class=\"heading-link\" href=\"#calling-configbuild-and-handling-errors\">Calling <code>Config::build</code> and Handling Errors<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">To handle the error case and print a user-friendly message, we need to update\n<code>main</code> to handle the <code>Result</code> being returned by <code>Config::build</code>, as shown in\nListing 12-10. We’ll also take the responsibility of exiting the command line\ntool with a nonzero error code away from <code>panic!</code> and instead implement it by\nhand. A nonzero exit status is a convention to signal to the process that\ncalled our program that the program exited with an error state.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-10/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">10</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-10: Exiting with an error code if building a\n<code>Config</code> fails</span></p>\n<p dir=\"auto\">In this listing, we’ve used a method we haven’t covered in detail yet:\n<code>unwrap_or_else</code>, which is defined on <code>Result&lt;T, E&gt;</code> by the standard library.\nUsing <code>unwrap_or_else</code> allows us to define some custom, non-<code>panic!</code> error\nhandling. If the <code>Result</code> is an <code>Ok</code> value, this method’s behavior is similar\nto <code>unwrap</code>: it returns the inner value <code>Ok</code> is wrapping. However, if the value\nis an <code>Err</code> value, this method calls the code in the <em>closure</em>, which is an\nanonymous function we define and pass as an argument to <code>unwrap_or_else</code>. We’ll\ncover closures in more detail in <a href=\"/rust-lang/book/blob/main/src/ch13-00-functional-features.html\">Chapter 13</a>. For now,\nyou just need to know that <code>unwrap_or_else</code> will pass the inner value of the\n<code>Err</code>, which in this case is the static string <code>\"not enough arguments\"</code> that we\nadded in Listing 12-9, to our closure in the argument <code>err</code> that appears\nbetween the vertical pipes. The code in the closure can then use the <code>err</code>\nvalue when it runs.</p>\n<p dir=\"auto\">We’ve added a new <code>use</code> line to bring <code>process</code> from the standard library into\nscope. The code in the closure that will be run in the error case is only two\nlines: we print the <code>err</code> value and then call <code>process::exit</code>. The\n<code>process::exit</code> function will stop the program immediately and return the\nnumber that was passed as the exit status code. This is similar to the\n<code>panic!</code>-based handling we used in Listing 12-8, but we no longer get all the\nextra output. Let’s try it:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch12-an-io-project/listing-12-10/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch12-an-io-project/listing-12-10/output.txt}}</span></pre></div>\n<p dir=\"auto\">Great! This output is much friendlier for our users.</p>\n<h3 tabindex=\"-1\" id=\"user-content-extracting-logic-from-main\" dir=\"auto\"><a class=\"heading-link\" href=\"#extracting-logic-from-main\">Extracting Logic from <code>main</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Now that we’ve finished refactoring the configuration parsing, let’s turn to\nthe program’s logic. As we stated in <a href=\"#separation-of-concerns-for-binary-projects\">“Separation of Concerns for Binary\nProjects”</a>, we’ll\nextract a function named <code>run</code> that will hold all the logic currently in the\n<code>main</code> function that isn’t involved with setting up configuration or handling\nerrors. When we’re done, <code>main</code> will be concise and easy to verify by\ninspection, and we’ll be able to write tests for all the other logic.</p>\n<p dir=\"auto\">Listing 12-11 shows the extracted <code>run</code> function. For now, we’re just making\nthe small, incremental improvement of extracting the function. We’re still\ndefining the function in <em>src/main.rs</em>.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-11/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">11</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-11: Extracting a <code>run</code> function containing the\nrest of the program logic</span></p>\n<p dir=\"auto\">The <code>run</code> function now contains all the remaining logic from <code>main</code>, starting\nfrom reading the file. The <code>run</code> function takes the <code>Config</code> instance as an\nargument.</p>\n<h4 tabindex=\"-1\" id=\"user-content-returning-errors-from-the-run-function\" dir=\"auto\"><a class=\"heading-link\" href=\"#returning-errors-from-the-run-function\">Returning Errors from the <code>run</code> Function<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">With the remaining program logic separated into the <code>run</code> function, we can\nimprove the error handling, as we did with <code>Config::build</code> in Listing 12-9.\nInstead of allowing the program to panic by calling <code>expect</code>, the <code>run</code>\nfunction will return a <code>Result&lt;T, E&gt;</code> when something goes wrong. This will let\nus further consolidate the logic around handling errors into <code>main</code> in a\nuser-friendly way. Listing 12-12 shows the changes we need to make to the\nsignature and body of <code>run</code>.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-12/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">12</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-12: Changing the <code>run</code> function to return\n<code>Result</code></span></p>\n<p dir=\"auto\">We’ve made three significant changes here. First, we changed the return type of\nthe <code>run</code> function to <code>Result&lt;(), Box&lt;dyn Error&gt;&gt;</code>. This function previously\nreturned the unit type, <code>()</code>, and we keep that as the value returned in the\n<code>Ok</code> case.</p>\n<p dir=\"auto\">For the error type, we used the <em>trait object</em> <code>Box&lt;dyn Error&gt;</code> (and we’ve\nbrought <code>std::error::Error</code> into scope with a <code>use</code> statement at the top).\nWe’ll cover trait objects in <a href=\"/rust-lang/book/blob/main/src/ch17-00-oop.html\">Chapter 17</a>. For now, just\nknow that <code>Box&lt;dyn Error&gt;</code> means the function will return a type that\nimplements the <code>Error</code> trait, but we don’t have to specify what particular type\nthe return value will be. This gives us flexibility to return error values that\nmay be of different types in different error cases. The <code>dyn</code> keyword is short\nfor “dynamic.”</p>\n<p dir=\"auto\">Second, we’ve removed the call to <code>expect</code> in favor of the <code>?</code> operator, as we\ntalked about in <a href=\"/rust-lang/book/blob/main/src/ch09-02-recoverable-errors-with-result.html#a-shortcut-for-propagating-errors-the--operator\">Chapter 9</a>. Rather than\n<code>panic!</code> on an error, <code>?</code> will return the error value from the current function\nfor the caller to handle.</p>\n<p dir=\"auto\">Third, the <code>run</code> function now returns an <code>Ok</code> value in the success case.\nWe’ve declared the <code>run</code> function’s success type as <code>()</code> in the signature,\nwhich means we need to wrap the unit type value in the <code>Ok</code> value. This\n<code>Ok(())</code> syntax might look a bit strange at first, but using <code>()</code> like this is\nthe idiomatic way to indicate that we’re calling <code>run</code> for its side effects\nonly; it doesn’t return a value we need.</p>\n<p dir=\"auto\">When you run this code, it will compile but will display a warning:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#include ../listings/ch12-an-io-project/listing-12-12/output.txt}}\"><pre><span class=\"pl-c1\">{{#include ../listings/ch12-an-io-project/listing-12-12/output.txt}}</span></pre></div>\n<p dir=\"auto\">Rust tells us that our code ignored the <code>Result</code> value and the <code>Result</code> value\nmight indicate that an error occurred. But we’re not checking to see whether or\nnot there was an error, and the compiler reminds us that we probably meant to\nhave some error-handling code here! Let’s rectify that problem now.</p>\n<h4 tabindex=\"-1\" id=\"user-content-handling-errors-returned-from-run-in-main\" dir=\"auto\"><a class=\"heading-link\" href=\"#handling-errors-returned-from-run-in-main\">Handling Errors Returned from <code>run</code> in <code>main</code><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h4>\n<p dir=\"auto\">We’ll check for errors and handle them using a technique similar to one we used\nwith <code>Config::build</code> in Listing 12-10, but with a slight difference:</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/no-listing-01-handling-errors-in-main/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/no-listing-<span class=\"pl-c1\">01</span>-handling-errors-in-main/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">We use <code>if let</code> rather than <code>unwrap_or_else</code> to check whether <code>run</code> returns an\n<code>Err</code> value and call <code>process::exit(1)</code> if it does. The <code>run</code> function doesn’t\nreturn a value that we want to <code>unwrap</code> in the same way that <code>Config::build</code>\nreturns the <code>Config</code> instance. Because <code>run</code> returns <code>()</code> in the success case,\nwe only care about detecting an error, so we don’t need <code>unwrap_or_else</code> to\nreturn the unwrapped value, which would only be <code>()</code>.</p>\n<p dir=\"auto\">The bodies of the <code>if let</code> and the <code>unwrap_or_else</code> functions are the same in\nboth cases: we print the error and exit.</p>\n<h3 tabindex=\"-1\" id=\"user-content-splitting-code-into-a-library-crate\" dir=\"auto\"><a class=\"heading-link\" href=\"#splitting-code-into-a-library-crate\">Splitting Code into a Library Crate<svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a></h3>\n<p dir=\"auto\">Our <code>minigrep</code> project is looking good so far! Now we’ll split the\n<em>src/main.rs</em> file and put some code into the <em>src/lib.rs</em> file. That way we\ncan test the code and have a <em>src/main.rs</em> file with fewer responsibilities.</p>\n<p dir=\"auto\">Let’s move all the code that isn’t the <code>main</code> function from <em>src/main.rs</em> to\n<em>src/lib.rs</em>:</p>\n<ul dir=\"auto\">\n<li>The <code>run</code> function definition</li>\n<li>The relevant <code>use</code> statements</li>\n<li>The definition of <code>Config</code></li>\n<li>The <code>Config::build</code> function definition</li>\n</ul>\n<p dir=\"auto\">The contents of <em>src/lib.rs</em> should have the signatures shown in Listing 12-13\n(we’ve omitted the bodies of the functions for brevity). Note that this won’t\ncompile until we modify <em>src/main.rs</em> in Listing 12-14.</p>\n<p dir=\"auto\"><span>Filename: src/lib.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-13/src/lib.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">13</span>/src/lib<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-13: Moving <code>Config</code> and <code>run</code> into\n<em>src/lib.rs</em></span></p>\n<p dir=\"auto\">We’ve made liberal use of the <code>pub</code> keyword: on <code>Config</code>, on its fields and its\n<code>build</code> method, and on the <code>run</code> function. We now have a library crate that has\na public API we can test!</p>\n<p dir=\"auto\">Now we need to bring the code we moved to <em>src/lib.rs</em> into the scope of the\nbinary crate in <em>src/main.rs</em>, as shown in Listing 12-14.</p>\n<p dir=\"auto\"><span>Filename: src/main.rs</span></p>\n<div class=\"highlight highlight-source-rust notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{{#rustdoc_include ../listings/ch12-an-io-project/listing-12-14/src/main.rs:here}}\"><pre><span class=\"pl-kos\">{</span><span class=\"pl-kos\">{</span>#rustdoc_include ../listings/ch12-an-io-project/listing-<span class=\"pl-c1\">12</span>-<span class=\"pl-c1\">14</span>/src/main<span class=\"pl-kos\">.</span><span class=\"pl-c1\">rs</span><span class=\"pl-kos\">:</span>here<span class=\"pl-kos\">}</span><span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\"><span>Listing 12-14: Using the <code>minigrep</code> library crate in\n<em>src/main.rs</em></span></p>\n<p dir=\"auto\">We add a <code>use minigrep::Config</code> line to bring the <code>Config</code> type from the\nlibrary crate into the binary crate’s scope, and we prefix the <code>run</code> function\nwith our crate name. Now all the functionality should be connected and should\nwork. Run the program with <code>cargo run</code> and make sure everything works\ncorrectly.</p>\n<p dir=\"auto\">Whew! That was a lot of work, but we’ve set ourselves up for success in the\nfuture. Now it’s much easier to handle errors, and we’ve made the code more\nmodular. Almost all of our work will be done in <em>src/lib.rs</em> from here on out.</p>\n<p dir=\"auto\">Let’s take advantage of this newfound modularity by doing something that would\nhave been difficult with the old code but is easy with the new code: we’ll\nwrite some tests!</p>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"rust-lang","repoName":"book","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":true,"symbols":[]}},"copilotInfo":null,"csrf_tokens":{"/rust-lang/book/branches":{"post":"O_B2wQKC5Ae6g5waUm6Sqnvn92qxRY_IhtwA0ixWC2mNWa-ys0IWXSw9qh3DZmZ8v8lSvfSfpNl8l3IW-dyR4g"},"/repos/preferences":{"post":"jj_0tbnDrJpTCNzBfPag5Btz8UKUT0JO_LYtqy2pvxjPh4RU-J6CqEw1B0u4eLngojjxDanJwjVkB3ToYV95bQ"}}},"title":"book/src/ch12-03-improving-error-handling-and-modularity.md at main · rust-lang/book"}